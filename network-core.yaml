AWSTemplateFormatVersion: "2010-09-09"
Description: "Deploy Transit Gateway in Network Account with Inspection VPC"
Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label: 
          default: Account Configuration
        Parameters:
          - pManagementAccountId
          - pOrganizationId
      - Label: 
          default: Inspection VPC Settings
        Parameters:
          - pInspectionVpcCidr
          - pInspectionVpcFwSubnetACidr
          - pInspectionVpcFwSubnetBCidr
          - pInspectionVpcFwSubnetCCidr
          - pInspectionVpcTgwSubnetACidr
          - pInspectionVpcTgwSubnetBCidr
          - pInspectionVpcTgwSubnetCCidr
      - Label: 
          default: Egress VPC Settings
        Parameters:
          - pEgressVpcCidr
          - pEgressVpcFwSubnetACidr
          - pEgressVpcFwSubnetBCidr
          - pEgressVpcFwSubnetCCidr
          - pEgressVpcTgwSubnetACidr
          - pEgressVpcTgwSubnetBCidr
          - pEgressVpcTgwSubnetCCidr
          - pEgressVpcPublicSubnetACidr
          - pEgressVpcPublicSubnetBCidr
          - pEgressVpcPublicSubnetCCidr
      - Label:
          default: Transit Gateway Configuration
        Parameters:
          - pTgwAwsVpcNetworkSupernet
      - Label:
          default: Lambda Settings
        Parameters:
          - pS3SourceBucketLambdaLayer
      - Label:
          default: CloudWatch Log Retention
        Parameters:
          - pCloudWatchLogsRetentionPeriodLambda
          - pCloudWatchLogsRetentionPeriodNetworkFw
      - Label:
          default: Tagging Configuration
        Parameters:
          - pEnvironmentName
Parameters:
  pEnvironmentName:
    Type: String
    Description: "Select the Name of the Environment"
    AllowedValues:
      - Production
      - Test
      - Development
  pOrganizationId:
    Type: String
    Description: "The Amazon Organizations ID"
    MinLength: 12
    MaxLength: 12
    AllowedPattern: '^[o][\-][a-z0-9]{10}$'
    ConstraintDescription: "The Organization ID must be a 12 character string starting with o- and followed by 10 Lowercase Alphanumeric Characters."
  pManagementAccountId:
    Type: String
    Description: "The AWS Account ID of the AWS Management Account."
    AllowedPattern: '^[0-9]{12}$'
    ConstraintDescription: "This must be a 12 character string."
    MinLength: 12
    MaxLength: 12
  pInspectionVpcCidr:
    Type: String
    Description: "CIDR Block for the Inspection VPC"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 100.64.0.0/16
  pInspectionVpcFwSubnetACidr:
    Type: String
    Description: "CIDR Block for the Firewall Subnet in AZ1"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 100.64.0.0/28
  pInspectionVpcFwSubnetBCidr:
    Type: String
    Description: "CIDR Block for the Firewall Subnet in AZ2"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 100.64.0.16/28
  pInspectionVpcFwSubnetCCidr:
    Type: String
    Description: "CIDR Block for the Firewall Subnet in AZ3"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 100.64.0.32/28
  pInspectionVpcTgwSubnetACidr:
    Type: String
    Description: "CIDR Block for the Transit Gateway Subnet in AZ1"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 100.64.0.48/28
  pInspectionVpcTgwSubnetBCidr:
    Type: String
    Description: "CIDR Block for the Transit Gateway Subnet in AZ2"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 100.64.0.64/28
  pInspectionVpcTgwSubnetCCidr:
    Type: String
    Description: "CIDR Block for the Transit Gateway Subnet in AZ3"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 100.64.0.80/28
  pEgressVpcCidr:
    Type: String
    Description: "CIDR Block for the Egress VPC"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 10.10.0.0/16
  pEgressVpcFwSubnetACidr:
    Type: String
    Description: "CIDR Block for the Firewall Subnet in AZ1"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 10.10.0.0/28
  pEgressVpcFwSubnetBCidr:
    Type: String
    Description: "CIDR Block for the Firewall Subnet in AZ2"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 10.10.0.16/28
  pEgressVpcFwSubnetCCidr:
    Type: String
    Description: "CIDR Block for the Firewall Subnet in AZ3"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 10.10.0.32/28
  pEgressVpcTgwSubnetACidr:
    Type: String
    Description: "CIDR Block for the Transit Gateway Subnet in AZ1"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 10.10.0.48/28
  pEgressVpcTgwSubnetBCidr:
    Type: String
    Description: "CIDR Block for the Transit Gateway Subnet in AZ2"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 10.10.0.64/28
  pEgressVpcTgwSubnetCCidr:
    Type: String
    Description: "CIDR Block for the Transit Gateway Subnet in AZ3"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 10.10.0.80/28
  pEgressVpcPublicSubnetACidr:
    Type: String
    Description: "CIDR Block for the Public Gateway Subnet in AZ1"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 10.10.1.0/24
  pEgressVpcPublicSubnetBCidr:
    Type: String
    Description: "CIDR Block for the Public Gateway Subnet in AZ2"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 10.10.2.0/24
  pEgressVpcPublicSubnetCCidr:
    Type: String
    Description: "CIDR Block for the Public Gateway Subnet in AZ3"
    AllowedPattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$"
    ConstraintDescription: "CIDR block parameter must be in the form x.x.x.x/16-28"
    Default: 10.10.3.0/24
  pTgwAwsVpcNetworkSupernet:
    Type: String
    Description: "The Network Supernet that encompasses all AWS VPC Ranges that can be used within the Transit Gateway"
    Default: "10.0.0.0/8"
  pCloudWatchLogsRetentionPeriodLambda:
    Type: Number
    Description: "The Retention Period used by CloudWatch Log Groups for all Lambda Functions"
    Default: 7
  pCloudWatchLogsRetentionPeriodNetworkFw:
    Type: Number
    Description: "The Retention Period used by CloudWatch Log Groups for all Network Firewalls"
    Default: 3
  pS3SourceBucketLambdaLayer:
    Type: String
    Description: "The S3 Bucket where the Lambda Layer is located"
    Default: "security-fixes-eu-west-2"
Resources:
############# VPC's, Subnets, Route Tables, Route Table Associations & Routes #############
  rInspectionVpc:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: !Ref pInspectionVpcCidr
      EnableDnsSupport: true
      EnableDnsHostnames: true
      Tags:
        - Key: Name
          Value: "Inspection-VPC"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rSubnetInspectionVpcFwA:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref rInspectionVpc
      CidrBlock: !Ref pInspectionVpcFwSubnetACidr
      AvailabilityZone: !Select [ 0, !GetAZs '' ]
      Tags:
        - Key: Name
          Value: "Inspection-VPC-Firewall-Subnet-A"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rSubnetInspectionVpcFwB:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref rInspectionVpc
      CidrBlock: !Ref pInspectionVpcFwSubnetBCidr
      AvailabilityZone: !Select [ 1, !GetAZs '' ]
      Tags:
        - Key: Name
          Value: "Inspection-VPC-Firewall-Subnet-B"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rSubnetInspectionVpcFwC:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref rInspectionVpc
      CidrBlock: !Ref pInspectionVpcFwSubnetCCidr
      AvailabilityZone: !Select [ 2, !GetAZs '' ]
      Tags:
        - Key: Name
          Value: "Inspection-VPC-Firewall-Subnet-C"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rSubnetInspectionVpcTgwA:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref rInspectionVpc
      CidrBlock: !Ref pInspectionVpcTgwSubnetACidr
      AvailabilityZone: !Select [ 0, !GetAZs '' ]
      Tags:
        - Key: Name
          Value: "Inspection-VPC-Transit-Gateway-Subnet-A"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rSubnetInspectionVpcTgwB:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref rInspectionVpc
      CidrBlock: !Ref pInspectionVpcTgwSubnetBCidr
      AvailabilityZone: !Select [ 1, !GetAZs '' ]
      Tags:
        - Key: Name
          Value: "Inspection-VPC-Transit-Gateway-Subnet-B"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rSubnetInspectionVpcTgwC:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref rInspectionVpc
      CidrBlock: !Ref pInspectionVpcTgwSubnetCCidr
      AvailabilityZone: !Select [ 2, !GetAZs '' ]
      Tags:
        - Key: Name
          Value: "Inspection-VPC-Transit-Gateway-Subnet-C"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRtbInspectionVpcFw:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref rInspectionVpc
      Tags:
        - Key: Name
          Value: "Inspection-VPC-Firewall-RTB"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRtbInspectionVpcTgwA:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref rInspectionVpc
      Tags:
        - Key: Name
          Value: "Inspection-VPC-TGW-RTB-A"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRtbInspectionVpcTgwB:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref rInspectionVpc
      Tags:
        - Key: Name
          Value: "Inspection-VPC-TGW-RTB-B"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRtbInspectionVpcTgwC:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref rInspectionVpc
      Tags:
        - Key: Name
          Value: "Inspection-VPC-TGW-RTB-C"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRtbAssociationInspectionVpcTgwSubnetA:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref rSubnetInspectionVpcTgwA
      RouteTableId: !Ref rRtbInspectionVpcTgwA
  rRtbAssociationInspectionVpcTgwSubnetB:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref rSubnetInspectionVpcTgwB
      RouteTableId: !Ref rRtbInspectionVpcTgwB
  rRtbAssociationInspectionVpcTgwSubnetC:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref rSubnetInspectionVpcTgwC
      RouteTableId: !Ref rRtbInspectionVpcTgwC
  rRtbAssociationInspectionVpcFwSubnetA:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref rSubnetInspectionVpcFwA
      RouteTableId: !Ref rRtbInspectionVpcFw
  rRtbAssociationInspectionVpcFwSubnetB:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref rSubnetInspectionVpcFwB
      RouteTableId: !Ref rRtbInspectionVpcFw
  rRtbAssociationInspectionVpcFwSubnetC:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref rSubnetInspectionVpcFwC
      RouteTableId: !Ref rRtbInspectionVpcFw
  rRouteInspectionVpcFwDefault:
    DependsOn:
      - rTgwAttachmentInspectionVpc
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref rRtbInspectionVpcFw
      DestinationCidrBlock: 0.0.0.0/0
      TransitGatewayId: !Ref rTgw

  rEgressVpc:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: !Ref pEgressVpcCidr
      EnableDnsSupport: true
      EnableDnsHostnames: true
      Tags:
        - Key: Name
          Value: "Egress-VPC"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rIgwEgressVpc:
    Type: AWS::EC2::InternetGateway
    Properties: 
      Tags:
        - Key: Name
          Value: "Egress-VPC-IGW"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rVpcGatewayAttachmentEgressVpc:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId: !Ref rEgressVpc
      InternetGatewayId: !Ref rIgwEgressVpc
  rSubnetEgressVpcFwA:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref rEgressVpc
      CidrBlock: !Ref pEgressVpcFwSubnetACidr
      AvailabilityZone: !Select [ 0, !GetAZs '' ]
      Tags:
        - Key: Name
          Value: "Egress-VPC-Firewall-Subnet-A"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rSubnetEgressVpcFwB:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref rEgressVpc
      CidrBlock: !Ref pEgressVpcFwSubnetBCidr
      AvailabilityZone: !Select [ 1, !GetAZs '' ]
      Tags:
        - Key: Name
          Value: "Egress-VPC-Firewall-Subnet-B"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rSubnetEgressVpcFwC:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref rEgressVpc
      CidrBlock: !Ref pEgressVpcFwSubnetCCidr
      AvailabilityZone: !Select [ 2, !GetAZs '' ]
      Tags:
        - Key: Name
          Value: "Egress-VPC-Firewall-Subnet-C"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rSubnetEgressVpcTgwA:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref rEgressVpc
      CidrBlock: !Ref pEgressVpcTgwSubnetACidr
      AvailabilityZone: !Select [ 0, !GetAZs '' ]
      Tags:
        - Key: Name
          Value: "Egress-VPC-Transit-Gateway-Subnet-A"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rSubnetEgressVpcTgwB:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref rEgressVpc
      CidrBlock: !Ref pEgressVpcTgwSubnetBCidr
      AvailabilityZone: !Select [ 1, !GetAZs '' ]
      Tags:
        - Key: Name
          Value: "Egress-VPC-Transit-Gateway-Subnet-B"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rSubnetEgressVpcTgwC:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref rEgressVpc
      CidrBlock: !Ref pEgressVpcTgwSubnetCCidr
      AvailabilityZone: !Select [ 2, !GetAZs '' ]
      Tags:
        - Key: Name
          Value: "Egress-VPC-Transit-Gateway-Subnet-C"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rSubnetEgressVpcPublicA:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref rEgressVpc
      CidrBlock: !Ref pEgressVpcPublicSubnetACidr
      AvailabilityZone: !Select [ 0, !GetAZs '' ]
      Tags:
        - Key: Name
          Value: "Egress-VPC-Public-Subnet-A"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rSubnetEgressVpcPublicB:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref rEgressVpc
      CidrBlock: !Ref pEgressVpcPublicSubnetBCidr
      AvailabilityZone: !Select [ 1, !GetAZs '' ]
      Tags:
        - Key: Name
          Value: "Egress-VPC-Public-Subnet-B"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rSubnetEgressVpcPublicC:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref rEgressVpc
      CidrBlock: !Ref pEgressVpcPublicSubnetCCidr
      AvailabilityZone: !Select [ 2, !GetAZs '' ]
      Tags:
        - Key: Name
          Value: "Egress-VPC-Public-Subnet-C"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRtbEgressVpcFwA:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref rEgressVpc
      Tags:
        - Key: Name
          Value: "Egress-VPC-Firewall-RTB-A"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRtbEgressVpcFwB:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref rEgressVpc
      Tags:
        - Key: Name
          Value: "Egress-VPC-Firewall-RTB-B"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRtbEgressVpcFwC:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref rEgressVpc
      Tags:
        - Key: Name
          Value: "Egress-VPC-Firewall-RTB-C"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRtbEgressVpcTgwA:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref rEgressVpc
      Tags:
        - Key: Name
          Value: "Egress-VPC-TGW-RTB-A"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRtbEgressVpcTgwB:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref rEgressVpc
      Tags:
        - Key: Name
          Value: "Egress-VPC-TGW-RTB-B"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRtbEgressVpcTgwC:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref rEgressVpc
      Tags:
        - Key: Name
          Value: "Egress-VPC-TGW-RTB-C"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRtbEgressVpcPublicA:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref rEgressVpc
      Tags:
        - Key: Name
          Value: "Egress-VPC-Public-RTB-A"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRtbEgressVpcPublicB:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref rEgressVpc
      Tags:
        - Key: Name
          Value: "Egress-VPC-Public-RTB-B"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRtbEgressVpcPublicC:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref rEgressVpc
      Tags:
        - Key: Name
          Value: "Egress-VPC-Public-RTB-C"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRtbAssociationEgressVpcPublicSubnetA:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref rSubnetEgressVpcPublicA
      RouteTableId: !Ref rRtbEgressVpcPublicA
  rRtbAssociationEgressVpcPublicSubnetB:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref rSubnetEgressVpcPublicB
      RouteTableId: !Ref rRtbEgressVpcPublicB
  rRtbAssociationEgressVpcPublicSubnetC:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref rSubnetEgressVpcPublicC
      RouteTableId: !Ref rRtbEgressVpcPublicC
  rRtbAssociationEgressVpcTgwSubnetA:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref rSubnetEgressVpcTgwA
      RouteTableId: !Ref rRtbEgressVpcTgwA
  rRtbAssociationEgressVpcTgwSubnetB:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref rSubnetEgressVpcTgwB
      RouteTableId: !Ref rRtbEgressVpcTgwB
  rRtbAssociationEgressVpcTgwSubnetC:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref rSubnetEgressVpcTgwC
      RouteTableId: !Ref rRtbEgressVpcTgwC
  rRtbAssociationEgressVpcFwSubnetA:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref rSubnetEgressVpcFwA
      RouteTableId: !Ref rRtbEgressVpcFwA
  rRtbAssociationEgressVpcFwSubnetB:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref rSubnetEgressVpcFwB
      RouteTableId: !Ref rRtbEgressVpcFwB
  rRtbAssociationEgressVpcFwSubnetC:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref rSubnetEgressVpcFwC
      RouteTableId: !Ref rRtbEgressVpcFwC
  rEipEgressVpcNatGwA:
    DependsOn: rVpcGatewayAttachmentEgressVpc
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
      Tags:
        - Key: Name
          Value: "Egress-VPC-EIP-NAT-Gateway-A"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rEipEgressVpcNatGwB:
    DependsOn: rVpcGatewayAttachmentEgressVpc
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
      Tags:
        - Key: Name
          Value: "Egress-VPC-EIP-NAT-Gateway-B"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rEipEgressVpcNatGwC:
    DependsOn: rVpcGatewayAttachmentEgressVpc
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
      Tags:
        - Key: Name
          Value: "Egress-VPC-EIP-NAT-Gateway-C"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rNatGwEgressVpcA:
    Type: AWS::EC2::NatGateway
    Properties:
      AllocationId: !GetAtt rEipEgressVpcNatGwA.AllocationId
      SubnetId: !Ref rSubnetEgressVpcPublicA
      Tags:
        - Key: Name
          Value: "Egress-VPC-NAT-Gateway-A"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rNatGwEgressVpcB:
    Type: AWS::EC2::NatGateway
    Properties:
      AllocationId: !GetAtt rEipEgressVpcNatGwB.AllocationId
      SubnetId: !Ref rSubnetEgressVpcPublicB
      Tags:
        - Key: Name
          Value: "Egress-VPC-NAT-Gateway-B"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rNatGwEgressVpcC:
    Type: AWS::EC2::NatGateway
    Properties:
      AllocationId: !GetAtt rEipEgressVpcNatGwC.AllocationId
      SubnetId: !Ref rSubnetEgressVpcPublicC
      Tags:
        - Key: Name
          Value: "Egress-VPC-NAT-Gateway-C"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rRouteEgressVpcPublicADefault:
    DependsOn: rVpcGatewayAttachmentEgressVpc
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref rRtbEgressVpcPublicA
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref rIgwEgressVpc
  rRouteEgressVpcPublicBDefault:
    DependsOn: rVpcGatewayAttachmentEgressVpc
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref rRtbEgressVpcPublicB
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref rIgwEgressVpc
  rRouteEgressVpcPublicCDefault:
    DependsOn: rVpcGatewayAttachmentEgressVpc
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref rRtbEgressVpcPublicC
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref rIgwEgressVpc
  rRouteEgressVpcFwADefault:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref rRtbEgressVpcFwA
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId: !Ref rNatGwEgressVpcA
  rRouteEgressVpcFwBDefault:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref rRtbEgressVpcFwB
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId: !Ref rNatGwEgressVpcB
  rRouteEgressVpcFwCDefault:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref rRtbEgressVpcFwC
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId: !Ref rNatGwEgressVpcC
  rRouteEgressVpcFwAAwsSupernet:
    DependsOn:
      - rTgwAttachmentEgressVpc
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref rRtbEgressVpcFwA
      DestinationCidrBlock: !Ref pTgwAwsVpcNetworkSupernet
      TransitGatewayId: !Ref rTgw
  rRouteEgressVpcFwBAwsSupernet:
    DependsOn:
      - rTgwAttachmentEgressVpc
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref rRtbEgressVpcFwB
      DestinationCidrBlock: !Ref pTgwAwsVpcNetworkSupernet
      TransitGatewayId: !Ref rTgw
  rRouteEgressVpcFwCAwsSupernet:
    DependsOn:
      - rTgwAttachmentEgressVpc
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref rRtbEgressVpcFwC
      DestinationCidrBlock: !Ref pTgwAwsVpcNetworkSupernet
      TransitGatewayId: !Ref rTgw
  rRouteEgressVpcTgwAAwsSupernet:
    DependsOn:
      - rTgwAttachmentEgressVpc
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref rRtbEgressVpcTgwA
      DestinationCidrBlock: !Ref pTgwAwsVpcNetworkSupernet
      TransitGatewayId: !Ref rTgw
  rRouteEgressVpcTgwBAwsSupernet:
    DependsOn:
      - rTgwAttachmentEgressVpc
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref rRtbEgressVpcTgwB
      DestinationCidrBlock: !Ref pTgwAwsVpcNetworkSupernet
      TransitGatewayId: !Ref rTgw
  rRouteEgressVpcTgwCAwsSupernet:
    DependsOn:
      - rTgwAttachmentEgressVpc
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref rRtbEgressVpcTgwC
      DestinationCidrBlock: !Ref pTgwAwsVpcNetworkSupernet
      TransitGatewayId: !Ref rTgw

############# Transit Gateway, Route Tables & Routes #############
  rTgw:
    Type: AWS::EC2::TransitGateway
    Properties: 
      AutoAcceptSharedAttachments: "enable"
      DefaultRouteTableAssociation: "disable"
      DefaultRouteTablePropagation: "disable"
      DnsSupport: "enable"
      MulticastSupport: "disable"
      Tags: 
        - Key: Name
          Value: "TGW"
        - Key: Environment
          Value: !Ref pEnvironmentName
      VpnEcmpSupport: "enable"
  rTgwRtbSpoke:
    Type: AWS::EC2::TransitGatewayRouteTable
    Properties: 
      Tags: 
        - Key: Name
          Value: "Spoke-RTB"
        - Key: Environment
          Value: !Ref pEnvironmentName
      TransitGatewayId: !Ref rTgw
  rTgwRtbFirewall:
    Type: AWS::EC2::TransitGatewayRouteTable
    Properties: 
      Tags: 
        - Key: Name
          Value: "Firewall-RTB"
        - Key: Environment
          Value: !Ref pEnvironmentName
      TransitGatewayId: !Ref rTgw
  rTgwAttachmentInspectionVpc:
    Type: AWS::EC2::TransitGatewayAttachment
    Properties: 
      SubnetIds: 
        - !Ref rSubnetInspectionVpcTgwA
        - !Ref rSubnetInspectionVpcTgwB
        - !Ref rSubnetInspectionVpcTgwC
      Tags:
        - Key: Name
          Value: "Inspection-VPC"
        - Key: Environment
          Value: !Ref pEnvironmentName
      TransitGatewayId: !Ref rTgw
      VpcId: !Ref rInspectionVpc
  rTgwAttachmentEgressVpc:
    Type: AWS::EC2::TransitGatewayAttachment
    Properties: 
      SubnetIds: 
        - !Ref rSubnetEgressVpcTgwA
        - !Ref rSubnetEgressVpcTgwB
        - !Ref rSubnetEgressVpcTgwC
      Tags:
        - Key: Name
          Value: "Egress-VPC"
        - Key: Environment
          Value: !Ref pEnvironmentName
      TransitGatewayId: !Ref rTgw
      VpcId: !Ref rEgressVpc
  rTgwRtbAssociationInspectionVpc:
    Type: AWS::EC2::TransitGatewayRouteTableAssociation
    Properties: 
      TransitGatewayAttachmentId: !Ref rTgwAttachmentInspectionVpc
      TransitGatewayRouteTableId: !Ref rTgwRtbFirewall
  rTgwRtbAssociationEgressVpc:
    Type: AWS::EC2::TransitGatewayRouteTableAssociation
    Properties: 
      TransitGatewayAttachmentId: !Ref rTgwAttachmentEgressVpc
      TransitGatewayRouteTableId: !Ref rTgwRtbFirewall
  rTgwRouteSpokeAwsSupernet:
    Type: AWS::EC2::TransitGatewayRoute
    Properties: 
      DestinationCidrBlock: !Ref pTgwAwsVpcNetworkSupernet
      TransitGatewayAttachmentId: !Ref rTgwAttachmentInspectionVpc
      TransitGatewayRouteTableId: !Ref rTgwRtbSpoke
  rTgwRouteSpokeDefault:
    Type: AWS::EC2::TransitGatewayRoute
    Properties: 
      DestinationCidrBlock: "0.0.0.0/0"
      TransitGatewayAttachmentId: !Ref rTgwAttachmentEgressVpc
      TransitGatewayRouteTableId: !Ref rTgwRtbSpoke

############# Resource Access Manager Shares #############
  rRamShareTgw:
    Type: AWS::RAM::ResourceShare
    Properties: 
      AllowExternalPrincipals: false
      Name: !Sub "RAM-Share-Transit-Gateway-${AWS::Region}"
      Principals: 
        - !Sub  "arn:aws:organizations::${pManagementAccountId}:organization/${pOrganizationId}"
      ResourceArns: 
        - !Sub "arn:aws:ec2:${AWS::Region}:${AWS::AccountId}:transit-gateway/${rTgw}"
      Tags: 
        - Key: Name
          Value: !Sub "RAM-Share-Transit-Gateway-${AWS::Region}"
        - Key: Environment
          Value: !Ref pEnvironmentName

############# Lambda Functions & Layers #############
  rLambdaEnableTgwAttachmentApplianceMode: 
    Type: AWS::Lambda::Function
    Properties: 
      Architectures:
        - x86_64
      Code: 
        ZipFile: |
          import boto3
          import os
          import cfnresponse
          from botocore.exceptions import ClientError

          ec2_client=boto3.client('ec2')
          tgw_attachment_ids=os.environ['TGW_ATTACHMENT_IDS']

          def lambda_handler(event, context):
              if (event['RequestType'] == 'Create' or event['RequestType'] == 'Update'):
                  tgw_attachment_id_list=tgw_attachment_ids.split(",")
                  for attachment_id in tgw_attachment_id_list:
                      try:
                          appliance_mode=ec2_client.modify_transit_gateway_vpc_attachment(
                              TransitGatewayAttachmentId=attachment_id,
                              Options={
                                  'ApplianceModeSupport': 'enable'
                              }
                          )['TransitGatewayVpcAttachment']['Options']['ApplianceModeSupport']
                          print(f"Appliance Mode for the Inspection VPC Transit Gateway Attachment is set to {appliance_mode}.")
                          cfnresponse.send(event, context, cfnresponse.SUCCESS, {})
                      except ClientError as e: 
                          print(f"Unable to Modify Transit Gateway Attacment ID: {attachment_id}. Error: {e}.") 
                          cfnresponse.send(event, context, cfnresponse.FAILED, e.response)
              elif event['RequestType'] == 'Delete':
                  tgw_attachment_id_list=tgw_attachment_ids.split(",")
                  for attachment_id in tgw_attachment_id_list:
                      try:
                          appliance_mode=ec2_client.modify_transit_gateway_vpc_attachment(
                              TransitGatewayAttachmentId=attachment_id,
                              Options={
                                  'ApplianceModeSupport': 'disable'
                              }
                          )['TransitGatewayVpcAttachment']['Options']['ApplianceModeSupport']
                          print(f"Appliance Mode for the Inspection VPC Transit Gateway Attachment is set to {appliance_mode}.")
                          cfnresponse.send(event, context, cfnresponse.SUCCESS, {})
                      except ClientError as e: 
                          print(f"Unable to Modify Transit Gateway Attacment ID: {attachment_id}. Error: {e}.") 
                          cfnresponse.send(event, context, cfnresponse.FAILED, e.response)
      Description: "Invoked by a CloudFormation Custom Resource to Enable Appliance Mode on a Transit Gateway Attachment"
      Environment:
        Variables:
            TGW_ATTACHMENT_IDS: !Sub "${rTgwAttachmentInspectionVpc},${rTgwAttachmentEgressVpc}"
      FunctionName: "Lambda-Enable-TGW-Attachment-Appliance-Mode"
      Handler: index.lambda_handler
      Layers:
        - !Ref rLambdaLayerCfnresponse
      MemorySize: 128
      Role: !GetAtt rIamRoleEnableTgwAttachmentApplianceMode.Arn
      Runtime: python3.9
      Tags: 
        - Key: Environment
          Value: !Ref pEnvironmentName
      Timeout: 30
      TracingConfig:
        Mode: "Active"
  rLambdaModifyTgwConfiguration: 
    Type: AWS::Lambda::Function
    Properties: 
      Architectures:
        - x86_64
      Code: 
        ZipFile: |
          import boto3
          import os
          import cfnresponse
          from botocore.exceptions import ClientError

          ec2_client=boto3.client('ec2')

          tgw_id=os.environ['TGW_ID']
          tgw_rtb_firewall_id=os.environ['TGW_RTB_FW_ID']
          tgw_rtb_spoke_id=os.environ['TGW_RTB_SPOKE_ID']

          def lambda_handler(event, context):
              if (event['RequestType'] == 'Create' or event['RequestType'] == 'Update'):
                  try:
                      response=ec2_client.modify_transit_gateway(
                          TransitGatewayId=tgw_id,
                          Options={
                              'DefaultRouteTableAssociation': 'enable',
                              'AssociationDefaultRouteTableId': tgw_rtb_spoke_id,
                              'DefaultRouteTablePropagation': 'enable',
                              'PropagationDefaultRouteTableId': tgw_rtb_firewall_id
                          }
                      )
                      print(response)
                      cfnresponse.send(event, context, cfnresponse.SUCCESS, {})
                  except ClientError as e: 
                      print(f"Unable to Modify Transit Gateway: {tgw_id}. Error: {e}.") 
                      cfnresponse.send(event, context, cfnresponse.FAILED, e.response)
              elif event['RequestType'] == 'Delete':
                  try:
                      response=ec2_client.modify_transit_gateway(
                          TransitGatewayId=tgw_id,
                          Options={
                              'DefaultRouteTableAssociation': 'disable',
                              'DefaultRouteTablePropagation': 'disable'
                          }
                      )
                      print(response)
                      cfnresponse.send(event, context, cfnresponse.SUCCESS, {})
                  except ClientError as e: 
                      print(f"Unable to Modify Transit Gateway: {tgw_id}. Error: {e}.") 
                      cfnresponse.send(event, context, cfnresponse.FAILED, e.response)
      Description: "Invoked by a CloudFormation Custom Resource to Modify the Configuration of the Transit Gateway "
      Environment:
        Variables:
            TGW_ID: !Ref rTgw
            TGW_RTB_FW_ID: !Ref rTgwRtbFirewall
            TGW_RTB_SPOKE_ID: !Ref rTgwRtbSpoke
      FunctionName: "Lambda-Modify-Transit-Gateway-Configuration"
      Handler: index.lambda_handler
      Layers:
        - !Ref rLambdaLayerCfnresponse
      MemorySize: 128
      Role: !GetAtt rIamRoleModifyTgwConfiguration.Arn
      Runtime: python3.9
      Tags: 
        - Key: Environment
          Value: !Ref pEnvironmentName
      Timeout: 30
      TracingConfig:
        Mode: "Active"
  rLambdaUpdateInspectionVpcRouteTables: 
    Type: AWS::Lambda::Function
    Properties: 
      Architectures:
        - x86_64
      Code: 
        ZipFile: |
          import boto3
          import os
          import cfnresponse
          from botocore.exceptions import ClientError

          network_fw_client=boto3.client('network-firewall')
          ec2_client=boto3.client('ec2')

          inspection_vpc_tgw_route_tables=os.environ['INSPECTION_VPC_TGW_RTBS']
          firewall_arn=os.environ['NETWORK_FIREWALL_ARN']

          def lambda_handler(event, context):
              if (event['RequestType'] == 'Create' or event['RequestType'] == 'Update'):
                  try:
                      route_table_list=inspection_vpc_tgw_route_tables.split(",")
                      try:
                          fw_endpoints=network_fw_client.describe_firewall(
                              FirewallArn=firewall_arn
                          )['FirewallStatus']['SyncStates']
                      except ClientError as e:
                          print(f"Unable to Describe Network Firewall: {firewall_arn}. Error: {e}.")
                      for table in route_table_list:
                          try:
                              associated_subnet_id=ec2_client.describe_route_tables(
                                  RouteTableIds=[
                                      table
                                  ]
                              )['RouteTables'][0]['Associations'][0]['SubnetId']
                          except ClientError as e:
                              print(f"Unable to Describe Route Table: {table}. Error: {e}.")
                          try:
                              subnet_az=ec2_client.describe_subnets(
                                  SubnetIds=[
                                      associated_subnet_id
                                  ]
                              )['Subnets'][0]['AvailabilityZone']
                          except ClientError as e:
                              print(f"Unable to Describe Subnet: {subnet_az}. Error: {e}.")
                          if subnet_az in fw_endpoints:
                              gwlb_endpoint=fw_endpoints[subnet_az]['Attachment']['EndpointId']
                              try:
                                  ec2_client.create_route(
                                      DestinationCidrBlock="0.0.0.0/0",
                                      VpcEndpointId=gwlb_endpoint,
                                      RouteTableId=table
                                  )
                                  print(f"Added Route to 0.0.0.0/0 via {gwlb_endpoint} in Route Table {table}.")
                              except ClientError as e:
                                  print(f"Unable to Add Route to Routing Table: {table}. Error: {e}.")
                      cfnresponse.send(event, context, cfnresponse.SUCCESS, {})
                  except ClientError as e: 
                      print(e.response['Error']['Message']) 
                      cfnresponse.send(event, context, cfnresponse.FAILED, e.response)
              elif event['RequestType'] == 'Delete':
                  try:
                      route_table_list=inspection_vpc_tgw_route_tables.split(",")
                      for table in route_table_list:
                          try:
                              ec2_client.delete_route(
                                  DestinationCidrBlock="0.0.0.0/0",
                                  RouteTableId=table
                              )
                          except ClientError as e:
                              print(f"Unable to Delete Route from Routing Table: {table}. Error: {e}.")
                      cfnresponse.send(event, context, cfnresponse.SUCCESS, {})
                  except ClientError as e: 
                      print(e.response['Error']['Message']) 
                      cfnresponse.send(event, context, cfnresponse.FAILED, e.response)
      Description: "Invoked by a CloudFormation Custom Resource to Update the Route Tables in the Inspection VPC for Correct Routes to Network Firewall Endpoints"
      Environment:
        Variables:
            INSPECTION_VPC_TGW_RTBS: !Sub "${rRtbInspectionVpcTgwA},${rRtbInspectionVpcTgwB},${rRtbInspectionVpcTgwC}"
            NETWORK_FIREWALL_ARN: !GetAtt rNetworkFwEastWest.FirewallArn
      FunctionName: "Lambda-Update-Inspection-VPC-Route-Tables"
      Handler: index.lambda_handler
      Layers:
        - !Ref rLambdaLayerCfnresponse
      MemorySize: 128
      Role: !GetAtt rIamRoleUpdateInspectionVpcRouteTables.Arn
      Runtime: python3.9
      Tags: 
        - Key: Environment
          Value: !Ref pEnvironmentName
      Timeout: 30
      TracingConfig:
        Mode: "Active"
  rLambdaUpdateEgressVpcRouteTables: 
    Type: AWS::Lambda::Function
    Properties: 
      Architectures:
        - x86_64
      Code: 
        ZipFile: |
          import boto3
          import os
          import cfnresponse
          from botocore.exceptions import ClientError

          network_fw_client=boto3.client('network-firewall')
          ec2_client=boto3.client('ec2')

          egress_vpc_tgw_route_tables=os.environ['EGRESS_VPC_TGW_RTBS']
          egress_vpc_public_route_tables=os.environ['EGRESS_VPC_PUBLIC_RTBS']
          aws_vpc_supernet=os.environ['AWS_VPC_SUPERNET']
          firewall_arn=os.environ['NETWORK_FIREWALL_ARN']

          def lambda_handler(event, context):
              if (event['RequestType'] == 'Create' or event['RequestType'] == 'Update'):
                  try:
                      tgw_route_table_list=egress_vpc_tgw_route_tables.split(",")
                      public_route_table_list=egress_vpc_public_route_tables.split(",")
                      try:
                          fw_endpoints=network_fw_client.describe_firewall(
                              FirewallArn=firewall_arn
                          )['FirewallStatus']['SyncStates']
                      except ClientError as e:
                          print(f"Unable to Describe Network Firewall: {firewall_arn}. Error: {e}.")
                      for table in tgw_route_table_list:
                          try:
                              associated_subnet_id=ec2_client.describe_route_tables(
                                  RouteTableIds=[
                                      table
                                  ]
                              )['RouteTables'][0]['Associations'][0]['SubnetId']
                          except ClientError as e:
                              print(f"Unable to Describe Route Table: {table}. Error: {e}.")
                          try:
                              subnet_az=ec2_client.describe_subnets(
                                  SubnetIds=[
                                      associated_subnet_id
                                  ]
                              )['Subnets'][0]['AvailabilityZone']
                          except ClientError as e:
                              print(f"Unable to Describe Subnet: {subnet_az}. Error: {e}.")
                          if subnet_az in fw_endpoints:
                              gwlb_endpoint=fw_endpoints[subnet_az]['Attachment']['EndpointId']
                              try:
                                  ec2_client.create_route(
                                      DestinationCidrBlock="0.0.0.0/0",
                                      VpcEndpointId=gwlb_endpoint,
                                      RouteTableId=table
                                  )
                                  print(f"Added Route to 0.0.0.0/0 via {gwlb_endpoint} in Route Table {table}.")
                              except ClientError as e:
                                  print(f"Unable to Add Route to Routing Table: {table}. Error: {e}.")
                      for table in public_route_table_list:
                          try:
                              associated_subnet_id=ec2_client.describe_route_tables(
                                  RouteTableIds=[
                                      table
                                  ]
                              )['RouteTables'][0]['Associations'][0]['SubnetId']
                          except ClientError as e:
                              print(f"Unable to Describe Route Table: {table}. Error: {e}.")
                          try:
                              subnet_az=ec2_client.describe_subnets(
                                  SubnetIds=[
                                      associated_subnet_id
                                  ]
                              )['Subnets'][0]['AvailabilityZone']
                          except ClientError as e:
                              print(f"Unable to Describe Subnet: {subnet_az}. Error: {e}.")
                          if subnet_az in fw_endpoints:
                              gwlb_endpoint=fw_endpoints[subnet_az]['Attachment']['EndpointId']
                              try:
                                  ec2_client.create_route(
                                      DestinationCidrBlock=aws_vpc_supernet,
                                      VpcEndpointId=gwlb_endpoint,
                                      RouteTableId=table
                                  )
                                  print(f"Added Route to 0.0.0.0/0 via {gwlb_endpoint} in Route Table {table}.")
                              except ClientError as e:
                                  print(f"Unable to Add Route to Routing Table: {table}. Error: {e}.")
                      cfnresponse.send(event, context, cfnresponse.SUCCESS, {})
                  except ClientError as e: 
                      print(e.response['Error']['Message']) 
                      cfnresponse.send(event, context, cfnresponse.FAILED, e.response)
              elif event['RequestType'] == 'Delete':
                  try:
                      tgw_route_table_list=egress_vpc_tgw_route_tables.split(",")
                      public_route_table_list=egress_vpc_public_route_tables.split(",")
                      for table in tgw_route_table_list:
                          try:
                              ec2_client.delete_route(
                                  DestinationCidrBlock="0.0.0.0/0",
                                  RouteTableId=table
                              )
                          except ClientError as e:
                              print(f"Unable to Delete Route from Routing Table: {table}. Error: {e}.")
                      for table in public_route_table_list:
                          try:
                              ec2_client.delete_route(
                                  DestinationCidrBlock=aws_vpc_supernet,
                                  RouteTableId=table
                              )
                          except ClientError as e:
                              print(f"Unable to Delete Route from Routing Table: {table}. Error: {e}.")
                      cfnresponse.send(event, context, cfnresponse.SUCCESS, {})
                  except ClientError as e: 
                      print(e.response['Error']['Message']) 
                      cfnresponse.send(event, context, cfnresponse.FAILED, e.response)
      Description: "Invoked by a CloudFormation Custom Resource to Update the Route Tables in the Egress VPC for Correct Routes to Network Firewall Endpoints"
      Environment:
        Variables:
            EGRESS_VPC_TGW_RTBS: !Sub "${rRtbEgressVpcTgwA},${rRtbEgressVpcTgwB},${rRtbEgressVpcTgwC}"
            EGRESS_VPC_PUBLIC_RTBS: !Sub "${rRtbEgressVpcPublicA},${rRtbEgressVpcPublicB},${rRtbEgressVpcPublicC}"
            NETWORK_FIREWALL_ARN: !GetAtt rNetworkFwEgress.FirewallArn
            AWS_VPC_SUPERNET: !Ref pTgwAwsVpcNetworkSupernet
      FunctionName: "Lambda-Update-Egress-VPC-Route-Tables"
      Handler: index.lambda_handler
      Layers:
        - !Ref rLambdaLayerCfnresponse
      MemorySize: 128
      Role: !GetAtt rIamRoleUpdateEgressVpcRouteTables.Arn
      Runtime: python3.9
      Tags: 
        - Key: Environment
          Value: !Ref pEnvironmentName
      Timeout: 30
      TracingConfig:
        Mode: "Active"
  rLambdaLayerCfnresponse:
    Type: AWS::Lambda::LayerVersion
    Properties:
      CompatibleRuntimes:
        - python3.9
      Content:
        S3Bucket: !Ref pS3SourceBucketLambdaLayer
        S3Key: "lambda-layers/cfnresponse.zip"
      Description: v1.1.2 of cfnresponse
      LayerName: cfnresponse

############# IAM Roles & Policies #############
  rIamRoleEnableTgwAttachmentApplianceMode:
    Type: AWS::IAM::Role
    Properties: 
      AssumeRolePolicyDocument: 
        Version: "2012-10-17"
        Statement: 
          - Effect: "Allow"
            Principal: 
              Service: 
                - "lambda.amazonaws.com"
            Action: 
              - "sts:AssumeRole"
      Path: "/"
      ManagedPolicyArns:
        - "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
        - "arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess"
        - !Ref rIamPolicyEnableTgwAttachmentApplianceMode
      RoleName: "LambdaExecutionRole-EnableTgwAttachmentApplianceMode"
  rIamPolicyEnableTgwAttachmentApplianceMode:
    Type: AWS::IAM::ManagedPolicy
    Properties: 
      ManagedPolicyName: "Custom-EnableTGWAttachmentApplianceMode"
      Path: "/"
      PolicyDocument:
        Version: "2012-10-17"
        Statement: 
          - Effect: "Allow"
            Action: 
              - "ec2:ModifyTransitGatewayVpcAttachment"
            Resource:
              - "*"
  rIamRoleModifyTgwConfiguration:
    Type: AWS::IAM::Role
    Properties: 
      AssumeRolePolicyDocument: 
        Version: "2012-10-17"
        Statement: 
          - Effect: "Allow"
            Principal: 
              Service: 
                - "lambda.amazonaws.com"
            Action: 
              - "sts:AssumeRole"
      Path: "/"
      ManagedPolicyArns:
        - "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
        - "arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess"
        - !Ref rIamPolicyModifyTgwConfiguration
      RoleName: "LambdaExecutionRole-ModifyTransitGatewayConfiguration"
  rIamPolicyModifyTgwConfiguration:
    Type: AWS::IAM::ManagedPolicy
    Properties: 
      ManagedPolicyName: "Custom-ModifyTransitGatewayConfiguration"
      Path: "/"
      PolicyDocument:
        Version: "2012-10-17"
        Statement: 
          - Effect: "Allow"
            Action: 
              - "ec2:ModifyTransitGateway"
            Resource:
              - "*"
  rIamRoleUpdateInspectionVpcRouteTables:
    Type: AWS::IAM::Role
    Properties: 
      AssumeRolePolicyDocument: 
        Version: "2012-10-17"
        Statement: 
          - Effect: "Allow"
            Principal: 
              Service: 
                - "lambda.amazonaws.com"
            Action: 
              - "sts:AssumeRole"
      Path: "/"
      ManagedPolicyArns:
        - "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
        - "arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess"
        - !Ref rIamPolicyUpdateInspectionVpcRouteTables
      RoleName: "LambdaExecutionRole-UpdateInspectionVpcRouteTables"
  rIamPolicyUpdateInspectionVpcRouteTables:
    Type: AWS::IAM::ManagedPolicy
    Properties: 
      ManagedPolicyName: "Custom-UpdateInspectionVpcRouteTables"
      Path: "/"
      PolicyDocument:
        Version: "2012-10-17"
        Statement: 
          - Effect: "Allow"
            Action: 
              - "network-firewall:DescribeFirewall"
            Resource:
              - !GetAtt rNetworkFwEastWest.FirewallArn
          - Effect: "Allow"
            Action: 
              - "ec2:*"
            Resource:
              - "*"
  rIamRoleUpdateEgressVpcRouteTables:
    Type: AWS::IAM::Role
    Properties: 
      AssumeRolePolicyDocument: 
        Version: "2012-10-17"
        Statement: 
          - Effect: "Allow"
            Principal: 
              Service: 
                - "lambda.amazonaws.com"
            Action: 
              - "sts:AssumeRole"
      Path: "/"
      ManagedPolicyArns:
        - "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
        - "arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess"
        - !Ref rIamPolicyUpdateEgressVpcRouteTables
      RoleName: "LambdaExecutionRole-UpdateEgressVpcRouteTables"
  rIamPolicyUpdateEgressVpcRouteTables:
    Type: AWS::IAM::ManagedPolicy
    Properties: 
      ManagedPolicyName: "Custom-UpdateEgressVpcRouteTables"
      Path: "/"
      PolicyDocument:
        Version: "2012-10-17"
        Statement: 
          - Effect: "Allow"
            Action: 
              - "network-firewall:DescribeFirewall"
            Resource:
              - !GetAtt rNetworkFwEgress.FirewallArn
          - Effect: "Allow"
            Action: 
              - "ec2:*"
            Resource:
              - "*"

############# CloudFormation Custom Resources #############
  rCustomResourceEnableTgwAttachmentApplianceMode:
    DependsOn:
      - rCloudWatchLogGroupEnableTgwAttachmentApplianceMode
    Type: Custom::EnableTgwAttachmentApplianceMode
    Properties:
      ServiceToken: !GetAtt rLambdaEnableTgwAttachmentApplianceMode.Arn
  rCustomResourceModifyTgwConfiguration:
    DependsOn:
      - rCloudWatchLogGroupModifyTgwConfiguration
    Type: Custom::ModifyTgwConfiguration
    Properties:
      ServiceToken: !GetAtt rLambdaModifyTgwConfiguration.Arn
  rCustomResourceUpdateInspectionVpcRouteTables:
    DependsOn:
      - rCloudWatchLogGroupUpdateInspectionVpcRouteTables
    Type: Custom::UpdateInspectionVpcRouteTables
    Properties:
      ServiceToken: !GetAtt rLambdaUpdateInspectionVpcRouteTables.Arn
  rCustomResourceUpdateEgressVpcRouteTables:
    DependsOn:
      - rCloudWatchLogGroupUpdateEgressVpcRouteTables
    Type: Custom::UpdateEgressVpcRouteTables
    Properties:
      ServiceToken: !GetAtt rLambdaUpdateEgressVpcRouteTables.Arn

############# CloudWatch Log Groups #############
  rCloudWatchLogGroupEnableTgwAttachmentApplianceMode:
    Type: AWS::Logs::LogGroup
    Properties: 
      LogGroupName: !Sub "/aws/lambda/${rLambdaEnableTgwAttachmentApplianceMode}"
      RetentionInDays: !Ref pCloudWatchLogsRetentionPeriodLambda
      Tags: 
        - Key: Environment
          Value: !Ref pEnvironmentName
  rCloudWatchLogGroupModifyTgwConfiguration:
    Type: AWS::Logs::LogGroup
    Properties: 
      LogGroupName: !Sub "/aws/lambda/${rLambdaModifyTgwConfiguration}"
      RetentionInDays: !Ref pCloudWatchLogsRetentionPeriodLambda
      Tags: 
        - Key: Environment
          Value: !Ref pEnvironmentName
  rCloudWatchLogGroupUpdateInspectionVpcRouteTables:
    Type: AWS::Logs::LogGroup
    Properties: 
      LogGroupName: !Sub "/aws/lambda/${rLambdaUpdateInspectionVpcRouteTables}"
      RetentionInDays: !Ref pCloudWatchLogsRetentionPeriodLambda
      Tags: 
        - Key: Environment
          Value: !Ref pEnvironmentName
  rCloudWatchLogGroupUpdateEgressVpcRouteTables:
    Type: AWS::Logs::LogGroup
    Properties: 
      LogGroupName: !Sub "/aws/lambda/${rLambdaUpdateEgressVpcRouteTables}"
      RetentionInDays: !Ref pCloudWatchLogsRetentionPeriodLambda
      Tags: 
        - Key: Environment
          Value: !Ref pEnvironmentName
  rCloudWatchLogGroupNetworkFwEastWest:
    Type: AWS::Logs::LogGroup
    Properties: 
      LogGroupName: !Sub "/firewall/${rNetworkFwEastWest.FirewallId}"
      RetentionInDays: !Ref pCloudWatchLogsRetentionPeriodNetworkFw
      Tags: 
        - Key: Environment
          Value: !Ref pEnvironmentName
  rCloudWatchLogGroupNetworkFwEgress:
    Type: AWS::Logs::LogGroup
    Properties: 
      LogGroupName: !Sub "/firewall/${rNetworkFwEgress.FirewallId}"
      RetentionInDays: !Ref pCloudWatchLogsRetentionPeriodNetworkFw
      Tags: 
        - Key: Environment
          Value: !Ref pEnvironmentName

############# Network Firewall #############
  rNetworkFwEastWest:
    Type: AWS::NetworkFirewall::Firewall
    Properties:
      FirewallName: "Central-Firewall-East-West"
      FirewallPolicyArn: !Ref rNetworkFwPolicyEastWest
      VpcId: !Ref rInspectionVpc
      SubnetMappings:
        - SubnetId: !Ref rSubnetInspectionVpcFwA
        - SubnetId: !Ref rSubnetInspectionVpcFwB
        - SubnetId: !Ref rSubnetInspectionVpcFwC
      Description: "Network Firewall for East/West Protection"
      Tags:
        - Key: Environment
          Value: !Ref pEnvironmentName
  rNetworkFwPolicyEastWest:
    Type: AWS::NetworkFirewall::FirewallPolicy
    Properties: 
      Description: "Firewall Policy for East/West Protection"
      FirewallPolicy: 
        StatelessDefaultActions: 
          - "aws:forward_to_sfe"
        StatelessFragmentDefaultActions: 
          - "aws:forward_to_sfe"
      FirewallPolicyName: "Central-Firewall-East-West"
      Tags:
        - Key: Name
          Value: "Central-Firewall-Policy-for-East-West-Protection"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rNetworkFwLoggingConfigurationEastWest:
    Type: AWS::NetworkFirewall::LoggingConfiguration
    Properties:
      FirewallArn: !GetAtt rNetworkFwEastWest.FirewallArn
      LoggingConfiguration:
        LogDestinationConfigs:
          - LogType: "FLOW"
            LogDestinationType: "CloudWatchLogs"
            LogDestination:
              logGroup: !Ref rCloudWatchLogGroupNetworkFwEastWest
          - LogType: "ALERT"
            LogDestinationType: "CloudWatchLogs"
            LogDestination:
              logGroup: !Ref rCloudWatchLogGroupNetworkFwEastWest
  rNetworkFwEgress:
    Type: AWS::NetworkFirewall::Firewall
    Properties:
      FirewallName: "Central-Firewall-Egress"
      FirewallPolicyArn: !Ref rNetworkFwPolicyEgress
      VpcId: !Ref rEgressVpc
      SubnetMappings:
        - SubnetId: !Ref rSubnetEgressVpcFwA
        - SubnetId: !Ref rSubnetEgressVpcFwB
        - SubnetId: !Ref rSubnetEgressVpcFwC
      Description: "Network Firewall for Egress Protection"
      Tags:
        - Key: Environment
          Value: !Ref pEnvironmentName
  rNetworkFwPolicyEgress:
    Type: AWS::NetworkFirewall::FirewallPolicy
    Properties: 
      Description: "Firewall Policy for Egress Protection"
      FirewallPolicy: 
        StatelessDefaultActions: 
          - "aws:forward_to_sfe"
        StatelessFragmentDefaultActions: 
          - "aws:forward_to_sfe"
        StatefulRuleGroupReferences:
          - ResourceArn: !Ref rNetworkFwRuleGroupAlertIcmp
          - ResourceArn: !Ref rNetworkFwRuleGroupPassAllowedDomains
          - ResourceArn: !Ref rNetworkFwRuleGroupAlertEmergingUserAgentsRules
          - ResourceArn: !Ref rNetworkFwRuleGroupAlertProtocolAnomaliesDetection
          - ResourceArn: !Ref rNetworkFwRuleGroupAlertEmergingThreats
      FirewallPolicyName: "Central-Firewall-Egress"
      Tags:
        - Key: Name
          Value: "Central-Firewall-Policy-for-Egress-Protection"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rNetworkFwLoggingConfigurationEgress:
    Type: AWS::NetworkFirewall::LoggingConfiguration
    Properties:
      FirewallArn: !GetAtt rNetworkFwEgress.FirewallArn
      LoggingConfiguration:
        LogDestinationConfigs:
          - LogType: "FLOW"
            LogDestinationType: CloudWatchLogs
            LogDestination:
              logGroup: !Ref rCloudWatchLogGroupNetworkFwEgress
          - LogType: "ALERT"
            LogDestinationType: CloudWatchLogs
            LogDestination:
              logGroup: !Ref rCloudWatchLogGroupNetworkFwEgress
  rNetworkFwRuleGroupAlertIcmp:
    Type: AWS::NetworkFirewall::RuleGroup
    Properties:
      RuleGroupName: "Alert-ICMP"
      Type: STATEFUL
      Capacity: 100
      RuleGroup:
        RulesSource:
          StatefulRules:
            - Action: "ALERT"
              Header:
                Direction: "ANY"
                Protocol: "ICMP"
                Destination: "ANY"
                Source: "ANY"
                DestinationPort: "ANY"
                SourcePort: "ANY"
              RuleOptions:
                - Keyword: "sid:1"
      Tags:
        - Key: Name
          Value: "Alert-ICMP"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rNetworkFwRuleGroupPassAllowedDomains:
    Type: AWS::NetworkFirewall::RuleGroup
    Properties:
      RuleGroupName: "Pass-Allowed-Domains"
      Type: "STATEFUL"
      Capacity: 100
      RuleGroup:
        RuleVariables:
          IPSets:
            HOME_NET:
              Definition:
                - !Ref pTgwAwsVpcNetworkSupernet
            EXTERNAL_NET:
              Definition:
                - "any"
        RulesSource:
          RulesSourceList:
            TargetTypes:
              - "HTTP_HOST"
              - "TLS_SNI"
            Targets: 
              - ".amazon.com"
              - ".amazonaws.com"
              - ".google.com"
            GeneratedRulesType: "ALLOWLIST"
      Tags:
        - Key: Name
          Value: "Pass-Allowed-Domains"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rNetworkFwRuleGroupAlertEmergingUserAgentsRules:
    Type: AWS::NetworkFirewall::RuleGroup
    Properties:
      RuleGroupName: "Alert-Emerging-User-Agents-Rules"
      Type: "STATEFUL"
      Capacity: 300
      RuleGroup:
        RuleVariables:
          IPSets:
            HOME_NET:
              Definition:
                - !Ref pTgwAwsVpcNetworkSupernet
            EXTERNAL_NET:
              Definition:
                - "any"
        RulesSource:
          RulesString: >-
            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Steam HTTP Client User-Agent"; flow:established,to_server; http.user_agent; content:"Valve/Steam HTTP Client"; depth:23; threshold: type limit, track by_src, count 1, seconds 300; classtype:policy-violation; sid:2028651; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_10_07, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2019_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Microsoft Dr Watson User-Agent (MSDW)"; flow:established,to_server; http.user_agent; content:"MSDW"; depth:4; isdataat:!1,relative; fast_pattern; threshold: type limit, track by_src, count 1, seconds 300; classtype:unknown; sid:2027389; rev:4; metadata:affected_product Web_Browsers, attack_target Client_Endpoint, created_at 2019_05_28, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2019_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (IExplorer 34)"; flow:established,to_server; http.user_agent; content:"IExplorer 34"; bsize:12; classtype:bad-unknown; sid:2028834; rev:1; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_10_16, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2019_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (reqwest/)"; flow:established,to_server; http.user_agent; content:"reqwest/"; depth:8; reference:md5,be59ae5fab354d29e53f11a08d805db7; classtype:bad-unknown; sid:2028842; rev:2; metadata:attack_target Client_Endpoint, created_at 2019_10_16, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2019_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (Client)"; flow:established,to_server; http.user_agent; content:"Client"; bsize:6; http.header; content:"User-Agent|3a 20|Client|0d 0a|"; fast_pattern; classtype:bad-unknown; sid:2028912; rev:2; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2019_10_28, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2019_10_28;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (system_file/2.0)"; flow:established,to_server; content:"system_file/2.0"; http.user_agent; bsize:15; classtype:bad-unknown; sid:2028983; rev:1; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2019_11_15, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2019_11_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (DxD)"; flow:established,to_server; http.user_agent; bsize:3; content:"DxD"; fast_pattern; classtype:bad-unknown; sid:2029232; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_01_06, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2020_01_06;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS ABBCCoin Activity Observed"; flow:established,to_server; http.header; content:"User-Agent|3a 20|ABBCCoin"; fast_pattern; reference:md5,77ec579347955cfa32f219386337f5bb; classtype:misc-activity; sid:2029423; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2020_02_12, deployment Perimeter, signature_severity Minor, updated_at 2020_02_12;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (VB OpenUrl)"; flow:to_server,established; http.user_agent; bsize:10; content:"VB OpenUrl"; classtype:bad-unknown; sid:2029544; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_02_27, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_02_27;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (\xa4)"; flow:established,to_server; http.header; content:"|0d 0a|User-Agent|3a 20 a4 0d 0a|"; fast_pattern; http.user_agent; content:"|a4|"; bsize:1; classtype:bad-unknown; sid:2029554; rev:1; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2020_03_02, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2020_03_02;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (easyhttp client)"; flow:established,to_server; http.user_agent; content:"easyhttp client"; bsize:15; classtype:bad-unknown; sid:2029569; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_03_04, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_03_04;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (xPCAP)"; flow:established,to_server; http.user_agent; content:"xPCAP"; bsize:5; classtype:bad-unknown; sid:2029748; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_03_27, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_03_27;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (Http-connect)"; flow:established,to_server; http.user_agent; content:"Http-connect"; bsize:12; classtype:bad-unknown; sid:2029752; rev:1; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2020_03_30, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_03_30;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Shadowcoin Cryptocurrency UA Observed"; flow:established,to_server; http.header; content:"User-Agent|3a 20|ShadowCoin"; fast_pattern; classtype:misc-activity; sid:2029771; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2020_03_31, deployment Perimeter, signature_severity Minor, updated_at 2020_03_31;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Willowcoin Cryptocurrency UA Observed"; flow:established,to_server; http.header; content:"User-Agent|3a 20|WillowCoin"; fast_pattern; classtype:misc-activity; sid:2029772; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2020_03_31, deployment Perimeter, signature_severity Minor, updated_at 2020_03_31;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Malicious CASPER/Mirai UA"; flow:established,to_server; http.user_agent; content:"Mozilla/4.0   (compatible|3b|   MSIE   5.01|3b|   Windows   NT   5.0)"; bsize:63; fast_pattern; reference:url,www.blackberry.com/content/dam/blackberry-com/asset/enterprise/pdf/direct/report-bb-decade-of-the-rats.pdf; reference:md5,ea78869555018cdab3699e2df5d7e7f8; classtype:misc-activity; sid:2029892; rev:1; metadata:created_at 2020_04_13, updated_at 2020_04_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Sample"; flow:established,to_server; http.header; content:"User-Agent|3a 20|sample"; nocase; classtype:trojan-activity; sid:2012611; rev:6; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_03_31, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_04_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS suspicious user agent string (changhuatong)"; flow:to_server,established; http.header; content:"User-Agent|3a 20|changhuatong"; classtype:trojan-activity; sid:2012751; rev:3; metadata:created_at 2011_04_29, updated_at 2020_04_20;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (PhoneMonitor)"; flow:established,to_server; http.user_agent; content:"PhoneMonitor"; bsize:12; reference:md5,09aa3bb05a55b0df864d1e1709c29960; reference:url,blog.trendmicro.com/trendlabs-security-intelligence/coronavirus-update-app-leads-to-project-spy-android-and-ios-spyware/; classtype:trojan-activity; sid:2029980; rev:1; metadata:attack_target Mobile_Client, created_at 2020_04_20, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_04_20;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS suspicious user agent string (CholTBAgent)"; flow:to_server,established; threshold: type limit, count 2, seconds 40, track by_src; http.header; content:"User-Agent|3a 20|CholTBAgent"; classtype:trojan-activity; sid:2012757; rev:6; metadata:created_at 2011_04_30, updated_at 2020_04_20;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Fragment (WORKED)"; flow:established,to_server; http.user_agent; content:"WORKED"; classtype:trojan-activity; sid:2012909; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_05_31, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_04_20;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Win32/OnLineGames User-Agent (Revolution Win32)"; flow:established,to_server; http.header; content:"User-Agent|3A 20|Revolution"; reference:md5,1431f4ab4bbe3ad1087eb14cf4d7dff9; classtype:trojan-activity; sid:2013542; rev:3; metadata:created_at 2011_09_06, updated_at 2020_04_20;)

            alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ET USER_AGENTS Atomic_Email_Hunter User-Agent Inbound"; flow:established,to_server; http.user_agent; content:"Atomic_Email_Hunter/"; startswith; reference:url,www.useragentstring.com/pages/useragentstring.php; classtype:attempted-recon; sid:2013173; rev:5; metadata:created_at 2011_07_04, updated_at 2020_04_21;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Atomic_Email_Hunter User-Agent Outbound"; flow:established,to_server; http.user_agent; content:"Atomic_Email_Hunter/"; startswith; reference:url,www.useragentstring.com/pages/useragentstring.php; classtype:attempted-recon; sid:2013174; rev:5; metadata:created_at 2011_07_04, updated_at 2020_04_21;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent SimpleClient 1.0"; flow:established,to_server; http.header; content:"User-Agent|3A| SimpleClient "; reference:url,www.fortiguard.com/encyclopedia/virus/symbos_sagasi.a!tr.html; classtype:bad-unknown; sid:2012860; rev:5; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_05_26, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_04_22;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (adlib)"; flow:established,to_server; http.header; content:"User-Agent|3A 20|adlib/"; reference:url,blog.trendmicro.com/connections-between-droiddreamlight-and-droidkungfu/; classtype:trojan-activity; sid:2013967; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_11_24, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_04_22;)

            alert http $HOME_NET 1024: -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious Win32 User Agent"; flow:to_server,established; http.header; content:"User-Agent|3a 20|Win32"; nocase; classtype:trojan-activity; sid:2012249; rev:5; metadata:created_at 2011_02_02, updated_at 2020_04_23;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS User-Agent (ChilkatUpload)"; flow:to_server,established; http.user_agent; content:"ChilkatUpload"; depth:13; nocase; reference:url,chilkatsoft.com; classtype:trojan-activity; sid:2016904; rev:4; metadata:created_at 2013_05_21, updated_at 2020_04_24;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS EmailSiphon Suspicious User-Agent Outbound"; flow:established,to_server; http.user_agent; content:"EmailSiphon"; nocase; depth:11; reference:url,www.useragentstring.com/pages/useragentstring.php; classtype:attempted-recon; sid:2013033; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_06_14, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_04_24;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious user agent (Google page)"; flow:to_server,established; http.header; content:"User-Agent|3a 20|Google page"; classtype:trojan-activity; sid:2017067; rev:6; metadata:created_at 2011_05_31, updated_at 2020_04_24;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Unknown - Java Request  - gt 60char hex-ascii"; flow:established,to_server; urilen:>60; http.uri; pcre:"/[\/\?][a-z0-9]{60,66}[\;0-9]/i"; http.user_agent; content:"Java/1."; fast_pattern; content:"Mozilla"; depth:7; classtype:trojan-activity; sid:2014912; rev:7; metadata:created_at 2012_06_16, former_category CURRENT_EVENTS, updated_at 2022_05_03;)

            alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ET USER_AGENTS FOCA User-Agent"; flow:established,to_server; http.method; content:"GET"; http.header_names; content:!"Referer|0d 0a|"; content:!"Accept|0d 0a|"; http.header; content:"User-Agent|3a 20|FOCA"; fast_pattern; reference:url,blog.bannasties.com/2013/08/vulnerability-scans/; classtype:attempted-recon; sid:2017949; rev:6; metadata:created_at 2014_01_10, updated_at 2020_04_27;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS BeeMovie Related Activity"; flow:to_server,established; http.header; content:"User-Agent|3a 20|BeeMovie/"; classtype:misc-activity; sid:2030050; rev:2; metadata:affected_product Android, attack_target Client_Endpoint, created_at 2020_04_29, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2020_04_29;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (h55u4u4u5uii5)"; flow:established,to_server; http.user_agent; content:"h55u4u4u5uii5"; bsize:13; reference:url,www.welivesecurity.com/2020/04/28/grandoreiro-how-engorged-can-exe-get/; classtype:trojan-activity; sid:2030058; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_04_29, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_04_29;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (DownloadMR)"; flow:to_server,established; http.user_agent; content:"DownloadMR"; nocase; depth:10; reference:url,www.virustotal.com/en/file/93236b781e147e3ac983be1374a5f807fabd27ee2b92e6d99e293a6eb070ac2b/analysis/; reference:md5,0da0d8e664f44400c19898b4c9e71456; classtype:trojan-activity; sid:2016903; rev:6; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2013_05_21, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_04_29;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (hi)"; flow:established,to_server; http.header; content:"User-Agent|3a 20|hi|0d 0a|"; nocase; classtype:trojan-activity; sid:2018381; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2014_04_10, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_04_29;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Possible QBot User-Agent"; flow:established,to_server; http.user_agent; bsize:14; content:"MelindaMelinda"; reference:md5,d5129d51bf982b055ee00fe7ef4da3c0; classtype:trojan-activity; sid:2030149; rev:1; metadata:created_at 2020_05_11, updated_at 2020_05_11;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (MSIE)"; flow:established,to_server; http.user_agent; content:"MSIE|28|6.00.2900.5512|20 28|"; fast_pattern; content:"|3b 20|NT|28|"; distance:0; content:"|29 3b 20|AV|28|"; distance:0; content:"|29 3b 20|OV|28|"; distance:0; content:"|29 3b 20|NA|28|"; distance:0; content:"VR|28|PH"; reference:url,documents.trendmicro.com/assets/Tech-Brief-Tropic-Trooper-s-Back-USBferry-Attack-Targets-Air-gapped-Environments.pdf; classtype:trojan-activity; sid:2030170; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_05_15, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_08_10;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS MSF Meterpreter Default User Agent"; flow:established,to_server; http.header; content:"User-Agent|3a 20|Mozilla/4.0 (compatible|3b 20|MSIE 6.1|3b 20|Windows NT|29 0d 0a|"; fast_pattern; reference:url,blog.didierstevens.com/2015/03/16/quickpost-metasploit-user-agent-strings; classtype:bad-unknown; sid:2021060; rev:3; metadata:created_at 2015_05_06, updated_at 2020_05_21;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (CODE)"; flow:established,to_server; http.header; content:"User-Agent|3a 20|CODE|0d 0a|"; fast_pattern; reference:md5,f5ee4c578976587586202c15e98997ed; classtype:bad-unknown; sid:2030439; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2020_07_01, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_07_01;)

            alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ET USER_AGENTS BLEXBot User-Agent"; flow:established,to_server; threshold:type limit, track by_dst, count 1, seconds 300; http.user_agent; content:"Mozilla/5.0 (compatible|3b 20|BLEXBot/"; fast_pattern; startswith; reference:url,webmeup.com/about.html; classtype:misc-activity; sid:2022775; rev:3; metadata:created_at 2016_05_02, former_category MALWARE, updated_at 2020_07_07;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (grab)"; flow:established,to_server; http.header; content:"User-Agent|3a 20|grab|0d 0a|"; classtype:bad-unknown; sid:2030492; rev:1; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2020_07_10, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_07_10;)

            alert http $EXTERNAL_NET any -> any any (msg:"ET USER_AGENTS SAP CVE-2020-6287 PoC UA Observed"; flow:established,to_server; http.user_agent; content:"CVE-2020-6287|20|PoC"; endswith; fast_pattern; reference:url,github.com/chipik/SAP_RECON/blob/master/RECON.py; classtype:attempted-recon; sid:2030548; rev:1; metadata:created_at 2020_07_16, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_07_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (justupdate)"; flow:established,to_server; http.user_agent; bsize:10; content:"justupdate"; reference:md5,7a814300b204e14467deff69c1159cbe; classtype:bad-unknown; sid:2030556; rev:1; metadata:created_at 2020_07_17, former_category USER_AGENTS, updated_at 2020_07_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (.NET Framework Client)"; flow:established,to_server; http.header; content:"User-Agent|3a 20|.NET Framework Client|0d 0a|"; classtype:bad-unknown; sid:2030586; rev:1; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2020_07_24, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2022_04_18;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (cctv.mtv)"; flow:established,to_server; http.user_agent; bsize:8; content:"cctv.mtv"; reference:md5,deffb804976c0531144d999ded0df8b9; classtype:bad-unknown; sid:2030598; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_07_27, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_07_27;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (cso)"; flow:established,to_server; http.user_agent; content:"cso v"; startswith; fast_pattern; pcre:"/^[0-9][0-9]?\.[0-9][0-9]?$/R"; reference:md5,5640851c35221c3ae7bbde053d1bb38e; reference:url,app.any.run/tasks/d94c1428-253d-432a-be65-53ea3a0505f4/; classtype:trojan-activity; sid:2030600; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_07_27, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_07_27;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (firefox)"; flow:established,to_server; http.user_agent; content:"firefox"; bsize:7; fast_pattern; reference:url,unit42.paloaltonetworks.com/oilrig-novel-c2-channel-steganography/; classtype:trojan-activity; sid:2030623; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_07_30, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2020_07_30;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (chrome)"; flow:established,to_server; http.user_agent; content:"chrome"; bsize:6; fast_pattern; reference:url,unit42.paloaltonetworks.com/oilrig-novel-c2-channel-steganography/; classtype:trojan-activity; sid:2030624; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_07_30, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2020_07_30;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Microsoft Edge on Windows 10 SET"; flow:established,to_server; flowbits:set,ET_EDGE_UA; flowbits:noalert; http.user_agent; content:"Windows NT 10."; content:"Edge/12."; distance:0; fast_pattern; classtype:misc-activity; sid:2023197; rev:5; metadata:affected_product Microsoft_Edge_Browser, created_at 2016_09_13, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, tag User_Agent, updated_at 2020_08_05;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Go HTTP Client User-Agent"; flow:established,to_server; http.user_agent; content:"Go-http-client"; nocase; fast_pattern; classtype:misc-activity; sid:2024897; rev:2; metadata:attack_target Client_Endpoint, created_at 2017_10_23, deployment Perimeter, former_category USER_AGENTS, signature_severity Major, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent - Possible Trojan Downloader (ver18/ver19 etc)"; flow:established,to_server; http.user_agent; content:")ver"; fast_pattern; pcre:"/\)ver\d/"; reference:url,doc.emergingthreats.net/2003380; classtype:trojan-activity; sid:2003380; rev:13; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, tag Trojan_Downloader, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS User-agent DownloadNetFile Win32.small.hsh downloader"; flow:established,to_server; http.method; content:"GET"; nocase; http.user_agent; content:"DownloadNetFile"; nocase; bsize:15; reference:url,doc.emergingthreats.net/2007778; classtype:trojan-activity; sid:2007778; rev:15; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (chek)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"chek"; depth:4; reference:url,doc.emergingthreats.net/bin/view/Main/2008253; classtype:trojan-activity; sid:2008253; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (AutoHotkey)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.header; content:!".ahk4.net|0d 0a|"; http.user_agent; content:"AutoHotkey"; depth:10; reference:url,doc.emergingthreats.net/bin/view/Main/2008259; classtype:trojan-activity; sid:2008259; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (contains loader)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"|20|loader"; fast_pattern; reference:url,doc.emergingthreats.net/bin/view/Main/2008276; classtype:trojan-activity; sid:2008276; rev:16; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (ErrCode)"; flow:established,to_server; http.user_agent; content:"ErrCode"; reference:url,doc.emergingthreats.net/bin/view/Main/2008378; classtype:trojan-activity; sid:2008378; rev:13; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Loands) - Possible Trojan Downloader GET Request"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.header; content:"User-Agent\: Loands|0d 0a|"; reference:url,doc.emergingthreats.net/2009537; classtype:trojan-activity; sid:2009537; rev:9; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, tag Trojan_Downloader, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (ms_ie) - Crypt.ZPACK Gen Trojan Downloader GET Request"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.header; content:"User-Agent\: ms_ie|0d 0a|"; nocase; reference:url,doc.emergingthreats.net/2009538; classtype:trojan-activity; sid:2009538; rev:7; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, tag Trojan_Downloader, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Forthgoner) - Possible Trojan Downloader GET Request"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.header; content:"User-Agent\: Forthgoner|0d 0a|"; nocase; reference:url,doc.emergingthreats.net/2009547; classtype:trojan-activity; sid:2009547; rev:7; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, tag Trojan_Downloader, updated_at 2022_05_03;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Si25f_302 User-Agent"; flow:established,to_server; http.user_agent; content:"Si25"; depth:4; classtype:trojan-activity; sid:2012310; rev:7; metadata:created_at 2011_02_14, former_category TROJAN, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Im Luo"; flow:established,to_server; http.user_agent; content:"Im|27|Luo"; startswith; classtype:trojan-activity; sid:2012586; rev:6; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_03_28, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS MacShield User-Agent Likely Malware"; flow:established,to_server; http.user_agent; content:"MacShield"; startswith; reference:url,blog.spiderlabs.com/2011/06/analysis-and-evolution-of-macdefender-os-x-fake-av-scareware.html; classtype:trojan-activity; sid:2012959; rev:5; metadata:created_at 2011_06_09, former_category TROJAN, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent _updater_agent"; flow:established,to_server; http.header; content:"User-Agent|3A 20|_updater_agent"; classtype:trojan-activity; sid:2013395; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_08_10, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (MadeByLc)"; flow:established,to_server; http.user_agent; content:"MadeBy"; startswith; classtype:trojan-activity; sid:2013512; rev:5; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_08_31, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS W32/OnlineGames User-Agent (LockXLS)"; flow:established,to_server; http.user_agent; content:"LockXLS"; startswith; classtype:trojan-activity; sid:2013724; rev:4; metadata:created_at 2011_10_01, former_category TROJAN, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (FULLSTUFF)"; flow: established,to_server; http.user_agent; content:"FULLSTUFF"; nocase; startswith; reference:url,threatexpert.com/reports.aspx?find=mrb.mail.ru; classtype:trojan-activity; sid:2013880; rev:5; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_11_08, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (HardCore Software For)"; flow:to_server,established; http.user_agent; content:"HardCore Software For"; depth:21; nocase; classtype:trojan-activity; sid:2018608; rev:6; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_07_06, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (App4)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"App"; depth:3; fast_pattern; pcre:"/^\d/R"; http.host; content:!"liveupdate.symantecliveupdate.com"; reference:url,doc.emergingthreats.net/bin/view/Main/2008073; classtype:trojan-activity; sid:2008073; rev:16; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Presto)"; flow:established,to_server; http.user_agent; content:"Opera/10.60 Presto/2.2.30"; http.header_names; content:!"Accept"; classtype:trojan-activity; sid:2012491; rev:9; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_03_12, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_08_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS WildTangent User-Agent (WT Games App)"; flow:established,to_server; http.header; content:"|0d 0a|WT-User-Agent|3a 20|WT|20|Games|20|App|20|"; classtype:policy-violation; sid:2021384; rev:3; metadata:created_at 2015_07_07, updated_at 2020_08_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Our_Agent)"; flow:established,to_server; http.user_agent; content:"Our_Agent"; classtype:trojan-activity; sid:2012278; rev:7; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_02_03, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_08_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (ClickAdsByIE)"; flow:to_server,established; http.user_agent; content:"ClickAdsByIE"; depth:12; reference:url,doc.emergingthreats.net/2010220; classtype:pup-activity; sid:2010220; rev:8; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Long Fake wget 3.0 User-Agent Detected"; flow:established,to_server; http.user_agent; content:"wget 3.0"; classtype:trojan-activity; sid:2013178; rev:6; metadata:created_at 2011_07_04, former_category TROJAN, updated_at 2020_08_18;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Ufasoft bitcoin Related User-Agent"; flow:established,to_server; http.user_agent; content:"Ufasoft"; depth:7; classtype:trojan-activity; sid:2013391; rev:6; metadata:created_at 2011_08_10, former_category TROJAN, updated_at 2020_08_18;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (MSIE)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"MSIE"; depth:4; http.host; content:!"www.msftncsi.com"; reference:url,doc.emergingthreats.net/bin/view/Main/2003657; classtype:trojan-activity; sid:2003657; rev:19; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_18;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (explorersvc)"; flow:established,to_server; http.user_agent; bsize:11; content:"explorersvc"; classtype:bad-unknown; sid:2029749; rev:2; metadata:attack_target Client_Endpoint, created_at 2020_03_27, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_08_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (KtulhuBrowser)"; flow:established,to_server; http.user_agent; bsize:13; content:"KtulhuBrowser"; nocase; classtype:bad-unknown; sid:2029750; rev:2; metadata:attack_target Client_Endpoint, created_at 2020_03_27, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_08_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspected Mekotio User-Agent (MyCustomUser)"; flow:established,to_server; http.user_agent; content:"MyCustomUser"; bsize:12; fast_pattern; reference:url,www.welivesecurity.com/2020/08/13/mekotio-these-arent-the-security-updates-youre-looking-for/; classtype:trojan-activity; sid:2030721; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_08_21, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_08_21;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspected Mekotio User-Agent (4M5yC6u4stom5U8se3r)"; flow:established,to_server; http.user_agent; content:"4M5yC6u4stom5U8se3r"; bsize:19; fast_pattern; reference:url,www.welivesecurity.com/2020/08/13/mekotio-these-arent-the-security-updates-youre-looking-for/; classtype:trojan-activity; sid:2030722; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_08_21, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_08_21;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (=Mozilla)"; flow:established,to_server; http.header; content:"User-Agent|3a|=Mozilla/5"; fast_pattern; classtype:trojan-activity; sid:2025456; rev:3; metadata:affected_product Web_Browsers, attack_target Client_and_Server, created_at 2018_03_27, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_08_25;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (InfoBot)"; flow:to_server,established; http.user_agent; content:"InfoBot"; nocase; reference:url,doc.emergingthreats.net/2011276; classtype:trojan-activity; sid:2011276; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_25;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (HTTP_CONNECT_)"; flow:established,to_server; http.user_agent; content:"HTTP_Connect_"; depth:13; reference:url,doc.emergingthreats.net/bin/view/Main/2007821; classtype:bad-unknown; sid:2007821; rev:8; metadata:attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, tag Spyware_User_Agent, updated_at 2020_08_25;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Windows XP)"; flow:to_server,established; http.user_agent; content:"Windows XP"; depth:10; classtype:bad-unknown; sid:2026519; rev:2; metadata:affected_product Web_Browsers, attack_target Client_Endpoint, created_at 2018_10_18, deployment Perimeter, former_category HUNTING, signature_severity Minor, updated_at 2020_08_26;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Windows 8)"; flow:to_server,established; http.user_agent; content:"Windows 8"; depth:9; classtype:bad-unknown; sid:2026520; rev:2; metadata:affected_product Web_Browsers, attack_target Client_Endpoint, created_at 2018_10_18, deployment Perimeter, former_category HUNTING, signature_severity Minor, updated_at 2020_08_26;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Windows 7)"; flow:to_server,established; http.user_agent; content:"Windows 7"; depth:9; classtype:bad-unknown; sid:2026522; rev:2; metadata:affected_product Web_Browsers, attack_target Client_Endpoint, created_at 2018_10_18, deployment Perimeter, former_category HUNTING, signature_severity Minor, updated_at 2020_08_26;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS SFML User-Agent (libsfml-network)"; flow:established,to_server; http.user_agent; content:"libsfml-network/"; depth:16; fast_pattern; reference:url,github.com/SFML; classtype:trojan-activity; sid:2026914; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_02_14, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2020_08_27;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Clever Internet Suite)"; flow:established,to_server; http.user_agent; content:"Clever Internet Suite"; classtype:trojan-activity; sid:2027045; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, created_at 2019_03_05, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_08_28;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (boostsoftware-urlexists)"; flow:established,to_server; http.user_agent; bsize:23; content:"boostsoftware-urlexists"; classtype:bad-unknown; sid:2030814; rev:2; metadata:attack_target Client_Endpoint, created_at 2020_08_28, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2020_08_28;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Aria2 User-Agent"; flow:to_server,established; http.user_agent; content:"aria2/"; depth:6; fast_pattern; reference:url,github.com/aria2/aria2; reference:md5,eb042fe28b8a235286df2c7f4ed1d8a8; classtype:trojan-activity; sid:2027286; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_04_25, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2020_08_28;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Fake Mozilla User-Agent String Observed (M0zilla)"; flow:established,to_server; http.user_agent; content:"M0zilla|2f|"; depth:8; fast_pattern; content:"."; distance:1; within:1; reference:md5,c6c1292bf7dd1573b269afb203134b1d; classtype:trojan-activity; sid:2027565; rev:2; metadata:created_at 2019_06_26, former_category USER_AGENTS, updated_at 2020_08_31;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (NSIS_Inetc (Mozilla))"; flow:established,to_server; http.user_agent; content:"NSIS|5f|Inetc|20 28|Mozilla|29|"; reference:url,doc.emergingthreats.net/2011227; classtype:bad-unknown; sid:2011227; rev:7; metadata:attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Minor, updated_at 2020_08_31;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (Microsoft Internet Explorer)"; flow:established,to_server; threshold:type limit, track by_src, count 2, seconds 360; http.user_agent; content:"Microsoft Internet Explorer"; depth:28; http.host; content:!"bbc.co.uk"; content:!"vmware.com"; content:!"rc.itsupport247.net"; content:!"msn.com"; content:!"msn.es"; content:!"live.com"; content:!"gocyberlink.com"; content:!"ultraedit.com"; content:!"windowsupdate.com"; content:!"cyberlink.com"; content:!"lenovo.com"; content:!"itsupport247.net"; content:!"msn.co.uk"; content:!"support.weixin.qq.com"; reference:url,doc.emergingthreats.net/bin/view/Main/2002400; classtype:trojan-activity; sid:2002400; rev:37; metadata:created_at 2010_07_30, former_category HUNTING, updated_at 2020_08_31;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS User-Agent (_TEST_)"; flow: to_server,established; http.user_agent; content:"_TEST_"; nocase; reference:url,doc.emergingthreats.net/2009545; classtype:unknown; sid:2009545; rev:11; metadata:created_at 2010_07_30, former_category ADWARE_PUP, updated_at 2020_08_31;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Microsoft Windows Vista UA - Commonly Abused"; flow:established,to_server; http.user_agent; content:"Mozilla/4.0 (compatible|3b 20|MSIE 7.0b|3b 20|Windows NT 6.0)"; fast_pattern; classtype:misc-activity; sid:2030847; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2020_09_08, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_09_08;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Session) - Possible Trojan-Clicker"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"Session"; depth:7; endswith; nocase; reference:url,doc.emergingthreats.net/2009512; classtype:trojan-activity; sid:2009512; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_09_14;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Installer)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"Installer"; depth:9; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008184; classtype:trojan-activity; sid:2008184; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_09_14;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (API-Guide test program) Used by Several trojans"; flow:established,to_server; http.user_agent; content:"API-Guide test program"; depth:22; nocase; endswith; reference:url,doc.emergingthreats.net/2007826; classtype:trojan-activity; sid:2007826; rev:9; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_09_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Mozilla/3.0"; flow:established,to_server; http.user_agent; content:"Mozilla/3.0"; fast_pattern; depth:11; endswith; classtype:trojan-activity; sid:2012619; rev:9; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_04_01, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_09_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Detected (RLMultySocket)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"RLMultySocket"; depth:13; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008603; classtype:trojan-activity; sid:2008603; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_09_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Downloader User-Agent HTTPGET"; flow:established,to_server; http.user_agent; content:"HTTPGET"; depth:7; http.host; content:!"autodesk.com"; endswith; content:!"rsa.com"; endswith; content:!"consumersentinel.gov"; endswith; content:!"technet.microsoft.com"; endswith; content:!"metropolis.com"; endswith; content:!"www.catalog.update.microsoft.com"; endswith; classtype:trojan-activity; sid:2013508; rev:14; metadata:created_at 2011_08_31, former_category TROJAN, updated_at 2020_09_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Win32/Feebs.kw Worm User-Agent Detected"; flow:established,to_server; http.user_agent; content:"Mozilla/4.7 [en] (WinNT"; depth:23; fast_pattern; reference:url,doc.emergingthreats.net/2007767; classtype:trojan-activity; sid:2007767; rev:9; metadata:created_at 2010_07_30, former_category USER_AGENTS, updated_at 2020_09_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Installed OK)"; flow:established,to_server; http.user_agent; content:"Installed OK"; startswith; nocase; reference:md5,16035440878ec6e93d82c2aeea508630; classtype:bad-unknown; sid:2030880; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_09_15, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2020_09_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Mozilla/3.0 (compatible))"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"Mozilla/3.0 (compatible)"; depth:24; endswith; http.host; content:!".hddstatus.com"; endswith; reference:url,doc.emergingthreats.net/2009867; classtype:trojan-activity; sid:2009867; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS VPNFilter Related UA (Gemini/2.0)"; flow:established,to_server; http.user_agent; content:"Gemini/2.0"; depth:10; fast_pattern; endswith; reference:url,twitter.com/m0rb/status/1021626709307805696; classtype:trojan-activity; sid:2025889; rev:3; metadata:attack_target Server, created_at 2018_07_25, deployment Perimeter, former_category USER_AGENTS, malware_family VPNFilter, performance_impact Low, signature_severity Major, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS VPNFilter Related UA (Hakai/2.0)"; flow:established,to_server; http.user_agent; content:"Hakai/2.0"; depth:9; fast_pattern; endswith; reference:url,twitter.com/m0rb/status/1021626709307805696; classtype:trojan-activity; sid:2025890; rev:4; metadata:attack_target Server, created_at 2018_07_25, deployment Perimeter, former_category USER_AGENTS, malware_family VPNFilter, performance_impact Low, signature_severity Major, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS MSIL/Peppy User-Agent"; flow:established,to_server; http.user_agent; content:"onedru/"; depth:7; endswith; fast_pattern; reference:md5,ebffb046d0e12b46ba5f27c0176b01c5; classtype:trojan-activity; sid:2026101; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2018_09_07, deployment Perimeter, former_category USER_AGENTS, malware_family Peppy, performance_impact Moderate, signature_severity Major, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS VPNFilter Related UA (curl53)"; flow:established,to_server; http.user_agent; content:"curl53"; depth:6; fast_pattern; endswith; reference:url,blog.talosintelligence.com/2018/09/vpnfilter-part-3.html; classtype:trojan-activity; sid:2026428; rev:4; metadata:affected_product Linux, attack_target Networking_Equipment, created_at 2018_10_01, deployment Perimeter, former_category USER_AGENTS, malware_family VPNFilter, signature_severity Major, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Windows 10)"; flow:to_server,established; http.user_agent; content:"Windows 10"; depth:10; http.host; content:!"google-analytics.com"; endswith; classtype:bad-unknown; sid:2026521; rev:4; metadata:affected_product Web_Browsers, attack_target Client_Endpoint, created_at 2018_10_18, deployment Perimeter, former_category HUNTING, signature_severity Minor, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious UA Observed (IEhook)"; flow:established,to_server; http.user_agent; content:"IEhook"; depth:6; endswith; fast_pattern; reference:md5,f0483493bcb352bd2f474b52f3b2f273; classtype:trojan-activity; sid:2026558; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2018_10_26, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, tag User_Agent, updated_at 2020_09_16;)

            alert http any any -> $HOME_NET any (msg:"ET USER_AGENTS WinRM User Agent Detected - Possible Lateral Movement"; flow:established,to_server; http.user_agent; content:"Microsoft|20|WinRM|20|Client"; depth:22; fast_pattern; endswith; reference:url,attack.mitre.org/techniques/T1028/; classtype:bad-unknown; sid:2026850; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_and_Server, created_at 2019_01_23, deployment Internal, former_category USER_AGENTS, performance_impact Low, signature_severity Major, tag WinRM, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Peppy/KeeOIL Google User-Agent (google/dance)"; flow:established,to_server; http.user_agent; content:"google/dance"; depth:14; fast_pattern; endswith; reference:url,www.malcrawler.com/team-simbaa-targets-indian-government-using-united-nations-military-observers-themed-malware-nicked-named-keeoil/; classtype:trojan-activity; sid:2026883; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_02_05, deployment Perimeter, former_category USER_AGENTS, malware_family Peppy, malware_family KeeOIL, performance_impact Low, signature_severity Major, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Peppy/KeeOIL User-Agent (ekeoil)"; flow:established,to_server; http.user_agent; content:"ekeoil/"; depth:7; fast_pattern; endswith; reference:url,www.malcrawler.com/team-simbaa-targets-indian-government-using-united-nations-military-observers-themed-malware-nicked-named-keeoil/; classtype:trojan-activity; sid:2026885; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_02_05, deployment Perimeter, former_category USER_AGENTS, malware_family Peppy, malware_family KeeOIL, performance_impact Low, signature_severity Major, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (SomeTimes)"; flow:established,to_server; http.user_agent; content:"SomeTimes"; depth:9; endswith; fast_pattern; reference:md5,a86d4e17389a37bfc291f4a8da51a9b8; classtype:trojan-activity; sid:2026898; rev:3; metadata:attack_target Client_Endpoint, created_at 2019_02_11, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, tag User_Agent, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (Mozilla 6.0)"; flow:established,to_server; http.user_agent; content:"Mozilla 6.0"; depth:11; endswith; classtype:bad-unknown; sid:2027142; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_04_01, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Microsoft Device Metadata Retrieval Client User-Agent"; flow:established,to_server; http.user_agent; content:"MICROSOFT_DEVICE_METADATA_RETRIEVAL_CLIENT"; depth:42; endswith; nocase; fast_pattern; classtype:misc-activity; sid:2027390; rev:4; metadata:affected_product Web_Browsers, attack_target Client_Endpoint, created_at 2019_05_28, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Node XMLHTTP User-Agent"; flow:established,to_server; http.user_agent; content:"node-XMLHttpRequest"; depth:19; endswith; nocase; fast_pattern; classtype:unknown; sid:2027388; rev:4; metadata:affected_product Web_Browsers, attack_target Client_Endpoint, created_at 2019_05_28, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious UA Observed (YourUserAgent)"; flow:established,to_server; http.user_agent; content:"YourUserAgent"; depth:13; fast_pattern; endswith; reference:md5,c1ca718e7304bf28b5c96559cbf69a06; classtype:bad-unknown; sid:2027484; rev:3; metadata:created_at 2019_06_17, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Minor, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (Hello, World)"; flow:established,to_server; http.user_agent; content:"Hello, World"; depth:12; endswith; classtype:bad-unknown; sid:2027503; rev:3; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2019_06_21, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Informational, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (Hello-World)"; flow:established,to_server; http.user_agent; content:"Hello-World"; depth:11; endswith; classtype:bad-unknown; sid:2027504; rev:3; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2019_06_21, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Informational, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious UA Observed (Ave, Caesar!)"; flow:established,to_server; http.user_agent; content:"Ave,|20|Caesar!"; depth:12; fast_pattern; endswith; classtype:bad-unknown; sid:2027648; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, created_at 2019_06_28, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Major, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (zwt)"; flow:established,to_server; http.user_agent; content:"zwt"; depth:3; endswith; classtype:bad-unknown; sid:2027649; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_07_01, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Informational, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (My Agent)"; flow:established,to_server; http.user_agent; content:"My Agent"; depth:8; endswith; classtype:bad-unknown; sid:2027650; rev:3; metadata:attack_target Client_Endpoint, created_at 2019_07_01, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Informational, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious Custom Firefox UA Observed (Firefox...)"; flow:established,to_server; http.user_agent; content:"Firefox..."; depth:10; fast_pattern; endswith; classtype:bad-unknown; sid:2027686; rev:3; metadata:created_at 2019_07_04, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Minor, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS User-Agent (single dash)"; flow:to_server,established; http.user_agent; content:"-"; depth:1; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2007880; classtype:trojan-activity; sid:2007880; rev:10; metadata:created_at 2010_07_30, former_category MALWARE, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious UA Observed (Quick Macros)"; flow:established,to_server; http.user_agent; content:"Quick|20|Macros"; depth:12; endswith; reference:md5,aa682f5d4a17307539a2bc7048be0745; classtype:trojan-activity; sid:2027755; rev:3; metadata:created_at 2019_07_24, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Minor, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (agent)"; flow:established,to_server; http.header; content:!"cn.patch.battlenet.com.cn"; http.user_agent; content:"agent"; depth:5; http.host; content:!".battle.net"; content:!".blizzard.com"; endswith; content:!"blz"; depth:3; reference:url,doc.emergingthreats.net/bin/view/Main/2001891; classtype:trojan-activity; sid:2001891; rev:24; metadata:created_at 2010_07_30, former_category HUNTING, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious Generic Style UA Observed (My_App)"; flow:established,to_server; http.user_agent; content:"My_App"; depth:6; fast_pattern; endswith; reference:md5,2978dbadd8fda7d842298fbd476b47b2; classtype:bad-unknown; sid:2027833; rev:4; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, created_at 2019_08_09, former_category HUNTING, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Mozilla/4.0 (compatible ICS))"; flow:established,to_server; http.user_agent; content:"Mozilla/4.0 (compatible|3b 20|ICS)"; depth:29; endswith; http.host; content:!".iobit.com"; content:!".microsoft.com"; content:!".cnn.com"; content:!".wunderground.com"; content:!".weatherbug.com"; content:!"iobit.com.s3.amazonaws.com"; reference:url,doc.emergingthreats.net/bin/view/Main/2008038; classtype:pup-activity; sid:2008038; rev:15; metadata:created_at 2010_07_30, former_category HUNTING, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (My Session)"; flow:to_server,established; http.user_agent; content:"My Session"; nocase; depth:10; http.host; content:!".windows.net"; endswith; reference:url,doc.emergingthreats.net/2010677; classtype:pup-activity; sid:2010677; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (Absent)"; flow:established,to_server; http.user_agent; content:"Absent"; depth:6; endswith; classtype:bad-unknown; sid:2028571; rev:3; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2019_09_12, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Informational, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS User-Agent (Internet Explorer)"; flow:established,to_server; http.user_agent; content:"Internet Explorer"; depth:17; endswith; nocase; http.host; content:!"pnrws.skype.com"; content:!"iecvlist.microsoft.com"; content:!".lenovo.com"; reference:url,doc.emergingthreats.net/bin/view/Main/2008052; classtype:bad-unknown; sid:2008052; rev:20; metadata:created_at 2010_07_30, former_category ADWARE_PUP, updated_at 2020_10_05;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS SideStep User-Agent"; flow: to_server,established; http.user_agent; content:"SideStep"; reference:url,doc.emergingthreats.net/2002078; reference:url,github.com/chetan51/sidestep/; classtype:misc-activity; sid:2002078; rev:32; metadata:attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, performance_impact Low, signature_severity Minor, tag User_Agent, updated_at 2020_10_08;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Moxilla"; flow:established,to_server; http.user_agent; content:"Moxilla"; depth:7; classtype:trojan-activity; sid:2012313; rev:7; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_02_14, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (VMozilla)"; flow:to_server,established; http.user_agent; content:"VMozilla"; depth:8; nocase; reference:url,www.microsoft.com/security/portal/Threat/Encyclopedia/Entry.aspx?Name=Worm%3aWin32%2fNeeris.BF; reference:url,www.avira.com/en/support-threats-description/tid/6259/tlang/en; classtype:trojan-activity; sid:2012555; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_03_25, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS suspicious User Agent (Lotto)"; flow:to_server,established; http.user_agent; content:"Lotto"; depth:5; classtype:trojan-activity; sid:2012695; rev:4; metadata:created_at 2011_04_20, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious user agent (mdms)"; flow:to_server,established; http.method; content:"GET"; http.user_agent; content:"mdms"; depth:4; endswith; classtype:trojan-activity; sid:2012761; rev:4; metadata:created_at 2011_05_03, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious user agent (asd)"; flow:to_server,established; http.method; content:"GET"; http.user_agent; content:"asd"; nocase; depth:3; endswith; classtype:trojan-activity; sid:2012762; rev:4; metadata:created_at 2011_05_03, updated_at 2020_10_13;)

            alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ET USER_AGENTS EmailSiphon Suspicious User-Agent Inbound"; flow:established,to_server; http.user_agent; content:"EmailSiphon"; nocase; depth:11; reference:url,www.useragentstring.com/pages/useragentstring.php; classtype:attempted-recon; sid:2013032; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_06_14, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Binget PHP Library User Agent Outbound"; flow:established,to_server; http.user_agent; content:"Binget/"; nocase; depth:7; reference:url,www.bin-co.com/php/scripts/load/; reference:url,www.useragentstring.com/pages/useragentstring.php; classtype:attempted-recon; sid:2013050; rev:4; metadata:created_at 2011_06_17, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS pxyscand/ Suspicious User Agent Outbound"; flow:established,to_server; http.user_agent; content:"pxyscand/"; nocase; depth:9; reference:url,www.useragentstring.com/pages/useragentstring.php; classtype:attempted-recon; sid:2013052; rev:4; metadata:created_at 2011_06_17, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS PyCurl Suspicious User Agent Outbound"; flow:established,to_server; http.user_agent; content:"PyCurl"; nocase; depth:6; reference:url,www.useragentstring.com/pages/useragentstring.php; classtype:attempted-recon; sid:2013054; rev:4; metadata:created_at 2011_06_17, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent String (AskPartnerCobranding)"; flow:to_server,established; http.user_agent; content:"AskPartner"; depth:10; classtype:trojan-activity; sid:2012734; rev:6; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_04_28, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (BlackSun)"; flow:to_server,established; http.user_agent; content:"BlackSun"; nocase; depth:8; reference:url,www.bitdefender.com/VIRUS-1000328-en--Trojan.Pws.Wow.NCY.html; reference:url,doc.emergingthreats.net/bin/view/Main/2008983; classtype:trojan-activity; sid:2008983; rev:8; metadata:created_at 2010_07_30, former_category HUNTING, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (AskInstallChecker)"; flow:to_server,established; http.method; content:"GET"; http.user_agent; content:"AskInstall"; depth:10; nocase; reference:url,doc.emergingthreats.net/2011225; classtype:policy-violation; sid:2011225; rev:8; metadata:created_at 2010_07_30, former_category HUNTING, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (XXX) Often Sony Update Related"; flow:established,to_server; http.user_agent; content:"XXX"; depth:3; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2010157; classtype:not-suspicious; sid:2010157; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Informational, tag User_Agent, updated_at 2020_10_14;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (USERAGENT)"; flow:to_server,established; http.user_agent; content:"USERAGENT"; nocase; depth:9; endswith; reference:md5,cd0e98508657b208219d435f9ac9d76c; reference:md5,cd100abc8eedf2119c7e6746975d7773; classtype:trojan-activity; sid:2034066; rev:7; metadata:created_at 2011_11_22, former_category USER_AGENTS, updated_at 2020_10_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS User-Agent (Unknown)"; flow:to_server,established; http.user_agent; content:"Unknown"; depth:7; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2007991; classtype:trojan-activity; sid:2007991; rev:10; metadata:created_at 2010_07_30, former_category MALWARE, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Metafisher/Goldun User-Agent (z)"; flow:to_server,established; http.user_agent; content:"z"; depth:1; endswith; reference:url,doc.emergingthreats.net/2002874; classtype:trojan-activity; sid:2002874; rev:17; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent outbound (bot)"; flow:to_server,established; threshold: type limit, count 3, seconds 300, track by_src; http.user_agent; content:"bot/"; depth:4; nocase; reference:url,doc.emergingthreats.net/bin/view/Main/2003622; classtype:trojan-activity; sid:2003622; rev:15; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (HTTPTEST) - Seen used by downloaders"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.header; content:!"PlayStation"; http.user_agent; content:"HTTPTEST"; nocase; depth:8; reference:url,doc.emergingthreats.net/bin/view/Main/2003927; classtype:trojan-activity; sid:2003927; rev:13; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Dialer-967 User-Agent"; flow:to_server,established; http.user_agent; content:"del"; depth:3; endswith; nocase; reference:url,doc.emergingthreats.net/2006364; classtype:trojan-activity; sid:2006364; rev:10; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (MYURL)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"MYURL"; depth:5; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2006365; classtype:trojan-activity; sid:2006365; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Downloader User-Agent Detected (Windows Updates Manager|3.12|...)"; flow:established,to_server; http.user_agent; content:"Windows Updates Manager|7c|"; depth:24; reference:url,doc.emergingthreats.net/2006387; classtype:trojan-activity; sid:2006387; rev:11; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Downloader User-Agent Detected (ld)"; flow:established,to_server; http.user_agent; content:"ld"; depth:2; endswith; reference:url,doc.emergingthreats.net/2006394; classtype:trojan-activity; sid:2006394; rev:10; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Tear Application User-Agent Detected"; flow:established,to_server; http.user_agent; content:"Tear Application"; depth:16; endswith; reference:url,doc.emergingthreats.net/2007770; classtype:trojan-activity; sid:2007770; rev:9; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent - Possible Trojan Downloader (WinInet)"; flow:established,to_server; http.user_agent; content:"WinInet"; depth:7; endswith; reference:url,doc.emergingthreats.net/2007837; classtype:trojan-activity; sid:2007837; rev:8; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, tag Trojan_Downloader, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Possible Trojan Downloader Shell"; flow:established,to_server; http.user_agent; content:"Shell"; depth:5; endswith; nocase; reference:url,doc.emergingthreats.net/2007840; reference:url,www.securelist.com/en/blog/434/The_Chinese_bootkit; classtype:trojan-activity; sid:2007840; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, tag Trojan_Downloader, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent - Possible Trojan Downloader (https)"; flow:established,to_server; http.user_agent; content:"https"; depth:5; endswith; nocase; reference:url,doc.emergingthreats.net/2008019; classtype:trojan-activity; sid:2008019; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, tag Trojan_Downloader, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Version 1.23)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"Version|20|"; depth:8; reference:url,doc.emergingthreats.net/bin/view/Main/2008048; classtype:trojan-activity; sid:2008048; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (INSTALLER)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"INSTALLER"; depth:9; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008096; classtype:trojan-activity; sid:2008096; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (IEMGR)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"IEMGR"; depth:5; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008097; classtype:trojan-activity; sid:2008097; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (GOOGLE)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"GOOGLE"; depth:6; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008098; classtype:trojan-activity; sid:2008098; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (RBR)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"RBR"; depth:3; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008147; classtype:trojan-activity; sid:2008147; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Otwycal User-Agent (Downing)"; flow:to_server,established; http.user_agent; content:"Downing"; depth:7; endswith; reference:url,doc.emergingthreats.net/2008159; classtype:trojan-activity; sid:2008159; rev:7; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (MS Internet Explorer)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"MS Internet Explorer"; depth:20; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008181; classtype:trojan-activity; sid:2008181; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (QQ)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.header; content:!"|0d 0a|Q-UA|3a 20|"; http.user_agent; content:"QQ"; depth:2; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008199; classtype:trojan-activity; sid:2008199; rev:20; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (SERVER2_03)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"SERVER"; depth:6; reference:url,doc.emergingthreats.net/bin/view/Main/2008209; classtype:trojan-activity; sid:2008209; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (WinProxy)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"WinProxy"; nocase; depth:8; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008211; classtype:trojan-activity; sid:2008211; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (sickness29a/0.1)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"sickness"; nocase; depth:8; reference:url,doc.emergingthreats.net/bin/view/Main/2008214; classtype:trojan-activity; sid:2008214; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (up2dash updater)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"up2dash"; nocase; depth:7; reference:url,doc.emergingthreats.net/bin/view/Main/2008215; classtype:trojan-activity; sid:2008215; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (NSIS_DOWNLOAD)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"NSIS_DOWNLOAD"; nocase; depth:13; reference:url,doc.emergingthreats.net/bin/view/Main/2008216; classtype:pup-activity; sid:2008216; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (IE)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"IE"; depth:2; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008255; classtype:trojan-activity; sid:2008255; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (WebForm 1)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"WebForm"; depth:7; reference:url,doc.emergingthreats.net/bin/view/Main/2008262; classtype:trojan-activity; sid:2008262; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (opera)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"opera"; depth:5; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008264; classtype:trojan-activity; sid:2008264; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (123)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"123"; depth:3; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008343; classtype:trojan-activity; sid:2008343; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (angel)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"angel"; depth:5; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008355; classtype:trojan-activity; sid:2008355; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Accessing)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"Accessing"; depth:9; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008361; classtype:trojan-activity; sid:2008361; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (ISMYIE)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"ISMYIE"; depth:6; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008363; classtype:trojan-activity; sid:2008363; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (svchost)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"svchost"; depth:7; nocase; reference:url,doc.emergingthreats.net/bin/view/Main/2008391; classtype:trojan-activity; sid:2008391; rev:14; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (ReadFileURL)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"ReadFileURL"; depth:11; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008400; classtype:trojan-activity; sid:2008400; rev:13; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Inet_read)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"Inet_read"; depth:9; reference:url,doc.emergingthreats.net/bin/view/Main/2008422; classtype:trojan-activity; sid:2008422; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (CFS Agent)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"CFS Agent"; depth:9; reference:url,doc.emergingthreats.net/bin/view/Main/2008423; classtype:trojan-activity; sid:2008423; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (CFS_DOWNLOAD)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"CFS_DOWNLOAD"; depth:12; reference:url,doc.emergingthreats.net/bin/view/Main/2008424; classtype:trojan-activity; sid:2008424; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (HTTP Downloader)"; flow: established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"HTTP Downloader"; depth:15; reference:url,doc.emergingthreats.net/bin/view/Main/2008428; classtype:trojan-activity; sid:2008428; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (HttpDownload)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"HttpDownload"; depth:12; reference:url,doc.emergingthreats.net/bin/view/Main/2008429; classtype:trojan-activity; sid:2008429; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Download App)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"Download App"; depth:12; reference:url,doc.emergingthreats.net/bin/view/Main/2008440; classtype:trojan-activity; sid:2008440; rev:14; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Downloader User-Agent (AutoDL\/1.0)"; flow:established,to_server; http.method; content:"GET"; nocase; http.user_agent; content:"AutoDL/1.0"; depth:10; endswith; reference:url,doc.emergingthreats.net/2008458; classtype:trojan-activity; sid:2008458; rev:11; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (hacker)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"hacker"; depth:6; reference:url,doc.emergingthreats.net/bin/view/Main/2008460; classtype:trojan-activity; sid:2008460; rev:13; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (SUiCiDE/1.5)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"SUiCiDE"; depth:7; reference:url,doc.emergingthreats.net/bin/view/Main/2008504; classtype:trojan-activity; sid:2008504; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (msIE 7.0)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"msIE"; depth:4; reference:url,doc.emergingthreats.net/bin/view/Main/2008513; classtype:trojan-activity; sid:2008513; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (AVP2006IE)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"AVP200"; depth:6; reference:url,doc.emergingthreats.net/bin/view/Main/2008514; classtype:trojan-activity; sid:2008514; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (winlogon)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"winlogon"; depth:8; reference:url,doc.emergingthreats.net/bin/view/Main/2008544; classtype:trojan-activity; sid:2008544; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Internet HTTP Request)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"Internet HTTP"; depth:13; reference:url,doc.emergingthreats.net/bin/view/Main/2008564; classtype:trojan-activity; sid:2008564; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Detected (Downloader1.2)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"Downloader"; depth:10; pcre:"/^Downloader\d+\.\d/"; reference:url,doc.emergingthreats.net/bin/view/Main/2008643; classtype:trojan-activity; sid:2008643; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Detected (Compatible)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"Compatible"; depth:10; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008657; classtype:trojan-activity; sid:2008657; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Detected (GetUrlSize)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"GetUrlSize"; depth:10; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008658; classtype:trojan-activity; sid:2008658; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Detected (WINS_HTTP_SEND Program/1.0)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"WINS_HTTP_SEND"; depth:14; reference:url,doc.emergingthreats.net/bin/view/Main/2008734; classtype:trojan-activity; sid:2008734; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (checkonline)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"checkonline"; depth:11; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008749; classtype:trojan-activity; sid:2008749; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Kvadrlson 1.0)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"Kvadrlson|20|"; depth:10; reference:url,doc.emergingthreats.net/bin/view/Main/2008756; classtype:trojan-activity; sid:2008756; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (miip)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"miip"; depth:4; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008797; classtype:trojan-activity; sid:2008797; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Mozil1a)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"Mozil1a"; depth:7; reference:url,doc.emergingthreats.net/bin/view/Main/2008847; classtype:trojan-activity; sid:2008847; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Errordigger.com related)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"min"; depth:3; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008912; classtype:trojan-activity; sid:2008912; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Trojan.Hijack.IrcBot.457 related)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"Mozilla/1.0 (compatible|3b 20|MSIE 8.0|3b|"; depth:34; reference:url,doc.emergingthreats.net/bin/view/Main/2008913; classtype:trojan-activity; sid:2008913; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (xr - Worm.Win32.VB.cj related)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"xr"; depth:2; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008914; classtype:trojan-activity; sid:2008914; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (HELLO)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"HELLO"; depth:5; endswith; nocase; reference:url,doc.emergingthreats.net/bin/view/Main/2008941; classtype:trojan-activity; sid:2008941; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (IE/1.0)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"IE/1.0"; depth:6; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008956; classtype:trojan-activity; sid:2008956; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (runUpdater.html)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"runUpdater|2e|html"; depth:15; reference:url,doc.emergingthreats.net/2009355; classtype:trojan-activity; sid:2009355; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (runPatch.html)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"runPatch|2e|html"; depth:13; reference:url,doc.emergingthreats.net/2009356; classtype:trojan-activity; sid:2009356; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (INet)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"INet"; depth:4; endswith; reference:url,doc.emergingthreats.net/2009703; classtype:trojan-activity; sid:2009703; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS User-Agent (STEROID Download)"; flow:established,to_server; http.user_agent; content:"STEROID Download"; nocase; depth:16; endswith; reference:url,anubis.iseclab.org/?action=result&task_id=17b118a86edba30f4f588db66eaf55d10; reference:url,security.thejoshmeister.com/2009/09/new-malware-ddos-botexe-etc-and.html; reference:url,doc.emergingthreats.net/2009994; classtype:trojan-activity; sid:2009994; rev:10; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Win32.OnLineGames User-Agent (BigFoot)"; flow:to_server,established; http.user_agent; content:"BigFoot"; nocase; depth:7; reference:url,doc.emergingthreats.net/2010678; classtype:trojan-activity; sid:2010678; rev:9; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (NateFinder)"; flow:to_server,established; http.user_agent; content:"NateFinder"; depth:10; classtype:trojan-activity; sid:2013881; rev:6; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_11_08, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Updater)"; flow:to_server,established; http.user_agent; content:"Updater"; depth:7; endswith; reference:url,doc.emergingthreats.net/2003470; classtype:pup-activity; sid:2003470; rev:13; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (update)"; flow:to_server,established; threshold: type limit, count 3, seconds 300, track by_src; http.user_agent; content:"update"; depth:6; endswith; reference:url,doc.emergingthreats.net/2003583; classtype:pup-activity; sid:2003583; rev:14; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Huai_Huai)"; flow:to_server,established; http.user_agent; content:"Huai_Huai"; depth:9; endswith; reference:md5,ee600bdcc45989750dee846b5049f935; reference:md5,91b9aa25563ae524d3ca4582630eb8eb; reference:md5,1051f7176fe0a50414649d369e752e98; classtype:pup-activity; sid:2006361; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (FTP)"; flow: to_server,established; http.user_agent; content:"Ftp"; nocase; depth:3; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008735; classtype:pup-activity; sid:2008735; rev:11; metadata:created_at 2010_07_30, former_category HUNTING, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (FaceCooker)"; flow:to_server,established; http.user_agent; content:"FaceCooker"; nocase; depth:10; reference:url,doc.emergingthreats.net/2010717; classtype:pup-activity; sid:2010717; rev:8; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (lineguide)"; flow:to_server,established; http.user_agent; content:"lineguide"; nocase; depth:9; reference:url,doc.emergingthreats.net/2011106; classtype:pup-activity; sid:2011106; rev:8; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Eldorado.BHO User-Agent Detected (MSIE 5.5)"; flow:established,to_server; http.method; content:"GET"; nocase; http.user_agent; content:"MSIE 5.5"; depth:8; endswith; reference:url,doc.emergingthreats.net/2007833; classtype:trojan-activity; sid:2007833; rev:9; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (ScrapeBox)"; flow:to_server,established; http.user_agent; content:"ScrapeBox"; depth:9; classtype:trojan-activity; sid:2011282; rev:6; metadata:created_at 2010_09_28, former_category HUNTING, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS suspicious user-agent (REKOM)"; flow:established,to_server; http.method; content:"GET"; http.user_agent; content:"REKOM"; nocase; depth:5; classtype:trojan-activity; sid:2012295; rev:6; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_02_07, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent VCTestClient"; flow:to_server,established; http.user_agent; content:"VCTestClient"; depth:12; nocase; classtype:trojan-activity; sid:2012386; rev:5; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_02_27, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Fire-Cloud)"; flow:established,to_server; http.user_agent; content:"Fire-Cloud"; bsize:10; reference:md5,804c8f7d3b10b421ab5c09d675644212; classtype:trojan-activity; sid:2031065; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_10_20, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2020_10_20;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Steam HTTP Client User-Agent"; flow:established,to_server; threshold: type limit, track by_src, count 1, seconds 300; http.user_agent; content:"SteamHTTPClient"; depth:15; endswith; classtype:policy-violation; sid:2028650; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_10_07, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_10_20;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (Autoupdate)"; flow:to_server,established; http.header; content:!" Creative AutoUpdate v"; http.user_agent; content:"Autoupdate"; nocase; depth:10; content:!"McAfeeAutoUpdate"; nocase; http.host; content:!"update.nai.com"; content:!"nokia.com"; content:!"sophosupd.com"; content:!"sophosupd.net"; content:!"wholetomato.com"; content:!".acclivitysoftware.com"; reference:url,doc.emergingthreats.net/bin/view/Main/2003337; classtype:pup-activity; sid:2003337; rev:22; metadata:created_at 2010_07_30, former_category HUNTING, updated_at 2020_11_02;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious HttpSocket User-Agent Observed"; flow:established,to_server; http.user_agent; content:"HttpSocket By Xswallow"; depth:22; classtype:misc-activity; sid:2031167; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2020_11_03, deployment Perimeter, signature_severity Major, updated_at 2020_11_03;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS AnyDesk Remote Desktop Software User-Agent"; flow:established,to_server; http.user_agent; content:"AnyDesk"; depth:7; reference:md5,1501639af59b0ff39d41577af30367cf; classtype:policy-violation; sid:2027762; rev:4; metadata:attack_target Client_Endpoint, created_at 2019_07_26, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2022_05_03;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS ESET Installer"; flow:established,to_server; threshold: type limit, track by_src, seconds 180, count 1; http.user_agent; content:"ESET Installer"; depth:14; endswith; classtype:policy-violation; sid:2027219; rev:4; metadata:attack_target Client_Endpoint, created_at 2019_04_17, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, tag PUA, updated_at 2022_05_03;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (downloader)"; flow:to_server,established; http.user_agent; content:"downloader"; depth:10; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2007885; classtype:pup-activity; sid:2007885; rev:13; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2022_05_03;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Simple Bot"; flow:established,to_server; http.user_agent; content:"Simple Bot v"; startswith; fast_pattern; reference:md5,3cf04350400299844abb17a0e1640975; classtype:bad-unknown; sid:2031471; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_12_31, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2020_12_31;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (aaaa)"; flow:established,to_server; http.user_agent; content:"aaaa"; bsize:4; reference:md5,61e213e717cc8e156cec79a7c1cd0c64; classtype:bad-unknown; sid:2031613; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_02_11, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2021_02_11;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Collection Info)"; flow:established,to_server; http.user_agent; content:"Collection Info/1.0"; bsize:19; fast_pattern; reference:md5,864eace6e6f67b77163d7ed5da4498c8; reference:url,github.com/AmnestyTech/investigations/tree/master/2021-02-24_vietnam; reference:url,www.amnesty.org/en/latest/research/2021/02/click-and-bait-vietnamese-human-rights-defenders-targeted-with-spyware-attacks/; classtype:bad-unknown; sid:2031684; rev:1; metadata:created_at 2021_03_01, former_category USER_AGENTS, performance_impact Low, updated_at 2021_03_01;)

            alert http any any -> any any (msg:"ET USER_AGENTS Suspicious User-Agent (HaxerMen)"; flow:established,to_server; http.user_agent; content:"HaxerMen"; bsize:8; fast_pattern; reference:md5,19aa54bd0c5a4b78f47247bb432b689d; classtype:bad-unknown; sid:2032081; rev:2; metadata:attack_target Client_Endpoint, created_at 2021_03_16, deployment Perimeter, former_category USER_AGENTS, signature_severity Major, updated_at 2021_03_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Non-standard User-Agent (PATCHER)"; flow:established,to_server; http.header; content:"User-Agent|3a 20|PATCHER|0d 0a|"; classtype:policy-violation; sid:2032938; rev:1; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2021_05_11, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2021_05_11;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious User-Agent (altera forma)"; flow:established,to_server; http.user_agent; content:"altera|20|forma"; bsize:12; fast_pattern; reference:md5,f019d3031c3aaf45dbd3630a33ab0991; classtype:bad-unknown; sid:2032948; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_05_12, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2021_05_12;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (MyAgent)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.header; content:!"www.google-analytics.com"; http.user_agent; content:"MyAgent"; depth:7; fast_pattern; http.host; content:!"driverdl.lenovo.com.cn"; reference:url,doc.emergingthreats.net/bin/view/Main/2005320; classtype:trojan-activity; sid:2005320; rev:16; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2021_06_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS WaterDropX PRISM UA Observed"; flow:established,to_server; http.user_agent; content:"agent-waterdropx"; fast_pattern; classtype:command-and-control; sid:2033269; rev:1; metadata:created_at 2021_07_07, former_category USER_AGENTS, malware_family PRISM, tag WaterDropX, updated_at 2021_07_07;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Malicious User-Agent (Brute Force Attacks)"; flow:established,to_server; http.user_agent; content:"Mozilla/5.0|20|(Windows|20|NT|20|10.0|3b 20|Win64|3b 20|x64)|20|AppleWebKit/537.36|20|(KHTML,|20|like|20|Gecko)|20|Chrome/70."; bsize:91; reference:url,media.defense.gov/2021/Jul/01/2002753896/-1/-1/1/CSA_GRU_GLOBAL_BRUTE_FORCE_CAMPAIGN_UOO158036-21.PDF; classtype:bad-unknown; sid:2033314; rev:1; metadata:created_at 2021_07_12, former_category USER_AGENTS, updated_at 2021_07_12;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Malicious User-Agent (Brute Force Attacks)"; flow:established,to_server; http.user_agent; content:"Microsoft|20|Office/14.0|20|(Windows|20|NT|20|6.1|3b 20|Microsoft|20|Outlook|20|14.0.7162|3b 20|Pro"; bsize:71; reference:url,media.defense.gov/2021/Jul/01/2002753896/-1/-1/1/CSA_GRU_GLOBAL_BRUTE_FORCE_CAMPAIGN_UOO158036-21.PDF; classtype:bad-unknown; sid:2033315; rev:1; metadata:created_at 2021_07_12, former_category USER_AGENTS, updated_at 2021_07_12;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS sysWeb User-Agent"; flow:established,to_server; http.user_agent; content:"|20|sysWeb/"; fast_pattern; reference:md5,3f295401fa59a32ff7a11551551ec607; reference:url,twitter.com/starsSk87264403/status/1422543872853426198; classtype:trojan-activity; sid:2033665; rev:1; metadata:created_at 2021_08_04, former_category USER_AGENTS, performance_impact Low, updated_at 2021_08_04;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Embarcadero URI Client/1.0)"; flow:established,to_server; http.user_agent; content:"Embarcadero URI Client/1.0"; bsize:26; reference:md5,c0e620ed4e96aa1fe8452a3f8b7e2e8d; classtype:bad-unknown; sid:2034244; rev:2; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2021_10_25, deployment Perimeter, former_category USER_AGENTS, signature_severity Major, tag User_Agent, updated_at 2021_10_25;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Microsoft-ATL-Native/9.00)"; flow:established,to_server; http.user_agent; content:"Microsoft-ATL-Native/9.00"; bsize:25; reference:md5,783aef84f5b315704ff6b064a00e2573; classtype:bad-unknown; sid:2034296; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_10_29, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2021_10_29;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (urlRequest)"; flow:established,to_server; http.user_agent; content:"urlRequest"; bsize:10; reference:md5,988fbcfeebf2a49af4072030dead68f9; classtype:bad-unknown; sid:2034298; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_10_29, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2021_10_29;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (test-upload)"; flow:established,to_server; http.user_agent; content:"test-upload"; nocase; bsize:11; reference:md5,c110a5814451bbfba9eb41a2b2328213; classtype:bad-unknown; sid:2034548; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_11_29, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2021_11_29;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (dBrowser CallGetResponse)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"dBrowser"; startswith; content:"CallGetResponse:"; fast_pattern; distance:3; within:16; pcre:"/^dBrowser\x20\d\x20CallGetResponse\x3a\d$/V"; reference:md5,e09ad59bff10bd4b730ee643809ec9a7; classtype:trojan-activity; sid:2034948; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2022_01_19, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2022_01_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (Chrome)"; flow:established,to_server; content:"User-Agent|3a 20|Chrome|0d 0a|"; http_header; fast_pattern; classtype:bad-unknown; sid:2027916; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2019_08_26, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Informational, updated_at 2022_01_25;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (example/1.0)"; flow:to_server,established; http.user_agent; content:"example/1.0"; bsize:11; startswith; reference:url,cybereason.com/blog/strifewater-rat-iranian-apt-moses-staff-adds-new-trojan-to-ransomware-operations; classtype:bad-unknown; sid:2035032; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2022_02_01, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2022_02_07;)

            alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ET USER_AGENTS Suspcious LeakIX User-Agent (l9explore)"; flow:established,to_server; http.user_agent; content:"l9explore"; startswith; fast_pattern; reference:url,ithub.com/LeakIX/l9format; classtype:bad-unknown; sid:2035314; rev:2; metadata:affected_product Linux, attack_target Server, created_at 2022_02_28, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2022_02_28;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (ItIsMe)"; flow:to_server,established; http.user_agent; content:"ItIsMe"; depth:6; fast_pattern; reference:url,resources.cylera.com/new-evidence-linking-kwampirs-malware-to-shamoon-apts; classtype:trojan-activity; sid:2035445; rev:2; metadata:attack_target Client_Endpoint, created_at 2022_03_14, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2022_03_14;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (HTTP-Test-Program)"; flow:to_server,established; http.user_agent; content:"HTTP-Test-Program"; bsize:17; startswith; reference:md5,6e69e15ae55aee85ace66bb99e6ba885; classtype:bad-unknown; sid:2035452; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2022_03_14, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2022_03_14;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Malicious User-Agent (CobaltStrike)"; flow:to_server,established; http.user_agent; content:"Mozilla/5.0_Frsg_stredf_o21_crown_type"; startswith; fast_pattern; reference:md5,b8b7a10dcc0dad157191620b5d4e5312; classtype:trojan-activity; sid:2035537; rev:2; metadata:attack_target Client_Endpoint, created_at 2022_03_18, deployment Perimeter, former_category USER_AGENTS, malware_family Cobalt_Strike, signature_severity Major, updated_at 2022_03_18, mitre_tactic_id TA0011, mitre_tactic_name Command_And_Control, mitre_technique_id T1001, mitre_technique_name Data_Obfuscation;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Malicious User-Agent (FastInvoice)"; flow:established,to_server; http.user_agent; content:"FastInvoice"; bsize:11; startswith; fast_pattern; reference:md5,42218b0ce7fc47f80aa239d4f9e000a1; classtype:bad-unknown; sid:2035932; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2022_04_13, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2022_04_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Bumblebee Loader User-Agent (bumblebee)"; flow:established,to_server; http.user_agent; content:"bumblebee"; bsize:9; fast_pattern; reference:md5,555b77d23549e231c8d7f0b003cc5164; reference:md5,3f34d94803e9c8bc0a9cd09f507bc515; reference:url,www.cynet.com/orion-threat-alert-flight-of-the-bumblebee/; reference:url,blog.google/threat-analysis-group/exposing-initial-access-broker-ties-conti/; classtype:trojan-activity; sid:2036237; rev:1; metadata:attack_target Client_Endpoint, created_at 2022_04_18, deployment Perimeter, deployment SSLDecrypt, former_category USER_AGENTS, malware_family Bumblebee_Loader, signature_severity Major, updated_at 2022_04_18;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed DPRK Related APT User-Agent (dafom)"; flow:established,to_server; http.user_agent; content:"dafom"; bsize:5; fast_pattern; reference:url,www.cisa.gov/uscert/ncas/current-activity/2022/04/18/north-korean-state-sponsored-apt-targets-blockchain-companies; classtype:bad-unknown; sid:2036260; rev:1; metadata:attack_target Client_Endpoint, created_at 2022_04_19, deployment Perimeter, deployment SSLDecrypt, former_category USER_AGENTS, signature_severity Informational, updated_at 2022_04_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (006)"; flow:established,to_server; http.user_agent; content:"00"; depth:2; pcre:"/00\d+$/"; reference:url,doc.emergingthreats.net/bin/view/Main/2006388; classtype:pup-activity; sid:2006388; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2022_05_03;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (REBOL)"; flow:established,to_server; http.user_agent; content:"REBOL"; nocase; startswith; reference:url,twitter.com/James_inthe_box/status/1441140639169609736; classtype:bad-unknown; sid:2034021; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2021_09_24, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2022_05_03;)
      Tags:
        - Key: Name
          Value: "Alert-Emerging-User-Agents-Rules"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rNetworkFwRuleGroupAlertProtocolAnomaliesDetection:
    Type: AWS::NetworkFirewall::RuleGroup
    Properties:
      RuleGroupName: "Alert-Protocol-Anomalies-Detection"
      Type: "STATEFUL"
      Capacity: 30
      RuleGroup:
        RuleVariables:
          IPSets:
            HOME_NET:
              Definition:
                - !Ref pTgwAwsVpcNetworkSupernet
            EXTERNAL_NET:
              Definition:
                - "any"
        RulesSource:
          RulesString: >-
            alert tcp any any -> any ![80,8080] (msg:"SURICATA HTTP but not tcp port 80, 8080"; flow:to_server; app-layer-protocol:http; sid:2271001; rev:1;)

            alert tcp any any -> any 80 (msg:"SURICATA Port 80 but not HTTP"; flow:to_server; app-layer-protocol:!http; sid:2271002; rev:1;)

            alert tcp any any -> any 443 (msg:"SURICATA Port 443 but not TLS"; flow:to_server; app-layer-protocol:!tls; sid:2271003; rev:1;)

            alert tcp any any -> any ![20,21] (msg:"SURICATA FTP but not tcp port 20 or 21"; flow:to_server; app-layer-protocol:ftp; sid:2271004; rev:1;)
            
            alert tcp any any -> any [20,21] (msg:"SURICATA TCP port 21 but not FTP"; flow:to_server; app-layer-protocol:!ftp; sid:2271005; rev:1;)

            alert tcp any any -> any ![25,587,465] (msg:"SURICATA SMTP but not tcp port 25,587,465"; flow:to_server; app-layer-protocol:smtp; sid:2271006; rev:1;)

            alert tcp any any -> any [25,587,465] (msg:"SURICATA TCP port 25,587,465 but not SMTP"; flow:to_server; app-layer-protocol:!smtp; sid:2271007; rev:1;)

            alert tcp any any -> any !22 (msg:"SURICATA SSH but not tcp port 22"; flow:to_server; app-layer-protocol:ssh; sid:2271008; rev:1;)
            
            alert tcp any any -> any 22 (msg:"SURICATA TCP port 22 but not SSH"; flow:to_server; app-layer-protocol:!ssh; sid:2271009; rev:1;)

            alert tcp any any -> any !143 (msg:"SURICATA IMAP but not tcp port 143"; flow:to_server; app-layer-protocol:imap; sid:2271010; rev:1;)

            alert tcp any any -> any 143 (msg:"SURICATA TCP port 143 but not IMAP"; flow:to_server; app-layer-protocol:!imap; sid:2271011; rev:1;)

            alert tcp any any -> any 139 (msg:"SURICATA TCP port 139 but not SMB"; flow:to_server; app-layer-protocol:!smb; sid:2271012; rev:1;)

            alert tcp any any -> any [80,8080] (msg:"SURICATA DCERPC detected over port tcp 80,8080"; flow:to_server; app-layer-protocol:dcerpc; sid:2271013; rev:1;)

            alert tcp any any -> any 53 (msg:"SURICATA TCP port 53 but not DNS"; flow:to_server; app-layer-protocol:!dns; sid:2271014; rev:1;)
            
            alert udp any any -> any 53 (msg:"SURICATA UDP port 53 but not DNS"; flow:to_server; app-layer-protocol:!dns; sid:2271015; rev:1;)
      Tags:
        - Key: Name
          Value: "Alert-Protocol-Anomalies-Detection"
        - Key: Environment
          Value: !Ref pEnvironmentName
  rNetworkFwRuleGroupAlertEmergingThreats:
    Type: AWS::NetworkFirewall::RuleGroup
    Properties:
      RuleGroupName: "Alert-Emerging-Threats"
      Type: "STATEFUL"
      Capacity: 300
      RuleGroup:
        RuleVariables:
          IPSets:
            HOME_NET:
              Definition:
                - !Ref pTgwAwsVpcNetworkSupernet
            EXTERNAL_NET:
              Definition:
                - "any"
        RulesSource:
          RulesString: >-
            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Steam HTTP Client User-Agent"; flow:established,to_server; http.user_agent; content:"Valve/Steam HTTP Client"; depth:23; threshold: type limit, track by_src, count 1, seconds 300; classtype:policy-violation; sid:2028651; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_10_07, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2019_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Microsoft Dr Watson User-Agent (MSDW)"; flow:established,to_server; http.user_agent; content:"MSDW"; depth:4; isdataat:!1,relative; fast_pattern; threshold: type limit, track by_src, count 1, seconds 300; classtype:unknown; sid:2027389; rev:4; metadata:affected_product Web_Browsers, attack_target Client_Endpoint, created_at 2019_05_28, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2019_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (IExplorer 34)"; flow:established,to_server; http.user_agent; content:"IExplorer 34"; bsize:12; classtype:bad-unknown; sid:2028834; rev:1; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_10_16, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2019_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (reqwest/)"; flow:established,to_server; http.user_agent; content:"reqwest/"; depth:8; reference:md5,be59ae5fab354d29e53f11a08d805db7; classtype:bad-unknown; sid:2028842; rev:2; metadata:attack_target Client_Endpoint, created_at 2019_10_16, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2019_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (Client)"; flow:established,to_server; http.user_agent; content:"Client"; bsize:6; http.header; content:"User-Agent|3a 20|Client|0d 0a|"; fast_pattern; classtype:bad-unknown; sid:2028912; rev:2; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2019_10_28, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2019_10_28;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (system_file/2.0)"; flow:established,to_server; content:"system_file/2.0"; http.user_agent; bsize:15; classtype:bad-unknown; sid:2028983; rev:1; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2019_11_15, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2019_11_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (DxD)"; flow:established,to_server; http.user_agent; bsize:3; content:"DxD"; fast_pattern; classtype:bad-unknown; sid:2029232; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_01_06, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2020_01_06;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS ABBCCoin Activity Observed"; flow:established,to_server; http.header; content:"User-Agent|3a 20|ABBCCoin"; fast_pattern; reference:md5,77ec579347955cfa32f219386337f5bb; classtype:misc-activity; sid:2029423; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2020_02_12, deployment Perimeter, signature_severity Minor, updated_at 2020_02_12;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (VB OpenUrl)"; flow:to_server,established; http.user_agent; bsize:10; content:"VB OpenUrl"; classtype:bad-unknown; sid:2029544; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_02_27, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_02_27;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (\xa4)"; flow:established,to_server; http.header; content:"|0d 0a|User-Agent|3a 20 a4 0d 0a|"; fast_pattern; http.user_agent; content:"|a4|"; bsize:1; classtype:bad-unknown; sid:2029554; rev:1; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2020_03_02, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2020_03_02;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (easyhttp client)"; flow:established,to_server; http.user_agent; content:"easyhttp client"; bsize:15; classtype:bad-unknown; sid:2029569; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_03_04, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_03_04;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (xPCAP)"; flow:established,to_server; http.user_agent; content:"xPCAP"; bsize:5; classtype:bad-unknown; sid:2029748; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_03_27, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_03_27;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (Http-connect)"; flow:established,to_server; http.user_agent; content:"Http-connect"; bsize:12; classtype:bad-unknown; sid:2029752; rev:1; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2020_03_30, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_03_30;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Shadowcoin Cryptocurrency UA Observed"; flow:established,to_server; http.header; content:"User-Agent|3a 20|ShadowCoin"; fast_pattern; classtype:misc-activity; sid:2029771; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2020_03_31, deployment Perimeter, signature_severity Minor, updated_at 2020_03_31;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Willowcoin Cryptocurrency UA Observed"; flow:established,to_server; http.header; content:"User-Agent|3a 20|WillowCoin"; fast_pattern; classtype:misc-activity; sid:2029772; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2020_03_31, deployment Perimeter, signature_severity Minor, updated_at 2020_03_31;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Malicious CASPER/Mirai UA"; flow:established,to_server; http.user_agent; content:"Mozilla/4.0   (compatible|3b|   MSIE   5.01|3b|   Windows   NT   5.0)"; bsize:63; fast_pattern; reference:url,www.blackberry.com/content/dam/blackberry-com/asset/enterprise/pdf/direct/report-bb-decade-of-the-rats.pdf; reference:md5,ea78869555018cdab3699e2df5d7e7f8; classtype:misc-activity; sid:2029892; rev:1; metadata:created_at 2020_04_13, updated_at 2020_04_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Sample"; flow:established,to_server; http.header; content:"User-Agent|3a 20|sample"; nocase; classtype:trojan-activity; sid:2012611; rev:6; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_03_31, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_04_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS suspicious user agent string (changhuatong)"; flow:to_server,established; http.header; content:"User-Agent|3a 20|changhuatong"; classtype:trojan-activity; sid:2012751; rev:3; metadata:created_at 2011_04_29, updated_at 2020_04_20;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (PhoneMonitor)"; flow:established,to_server; http.user_agent; content:"PhoneMonitor"; bsize:12; reference:md5,09aa3bb05a55b0df864d1e1709c29960; reference:url,blog.trendmicro.com/trendlabs-security-intelligence/coronavirus-update-app-leads-to-project-spy-android-and-ios-spyware/; classtype:trojan-activity; sid:2029980; rev:1; metadata:attack_target Mobile_Client, created_at 2020_04_20, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_04_20;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS suspicious user agent string (CholTBAgent)"; flow:to_server,established; threshold: type limit, count 2, seconds 40, track by_src; http.header; content:"User-Agent|3a 20|CholTBAgent"; classtype:trojan-activity; sid:2012757; rev:6; metadata:created_at 2011_04_30, updated_at 2020_04_20;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Fragment (WORKED)"; flow:established,to_server; http.user_agent; content:"WORKED"; classtype:trojan-activity; sid:2012909; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_05_31, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_04_20;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Win32/OnLineGames User-Agent (Revolution Win32)"; flow:established,to_server; http.header; content:"User-Agent|3A 20|Revolution"; reference:md5,1431f4ab4bbe3ad1087eb14cf4d7dff9; classtype:trojan-activity; sid:2013542; rev:3; metadata:created_at 2011_09_06, updated_at 2020_04_20;)

            alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ET USER_AGENTS Atomic_Email_Hunter User-Agent Inbound"; flow:established,to_server; http.user_agent; content:"Atomic_Email_Hunter/"; startswith; reference:url,www.useragentstring.com/pages/useragentstring.php; classtype:attempted-recon; sid:2013173; rev:5; metadata:created_at 2011_07_04, updated_at 2020_04_21;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Atomic_Email_Hunter User-Agent Outbound"; flow:established,to_server; http.user_agent; content:"Atomic_Email_Hunter/"; startswith; reference:url,www.useragentstring.com/pages/useragentstring.php; classtype:attempted-recon; sid:2013174; rev:5; metadata:created_at 2011_07_04, updated_at 2020_04_21;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent SimpleClient 1.0"; flow:established,to_server; http.header; content:"User-Agent|3A| SimpleClient "; reference:url,www.fortiguard.com/encyclopedia/virus/symbos_sagasi.a!tr.html; classtype:bad-unknown; sid:2012860; rev:5; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_05_26, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_04_22;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (adlib)"; flow:established,to_server; http.header; content:"User-Agent|3A 20|adlib/"; reference:url,blog.trendmicro.com/connections-between-droiddreamlight-and-droidkungfu/; classtype:trojan-activity; sid:2013967; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_11_24, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_04_22;)

            alert http $HOME_NET 1024: -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious Win32 User Agent"; flow:to_server,established; http.header; content:"User-Agent|3a 20|Win32"; nocase; classtype:trojan-activity; sid:2012249; rev:5; metadata:created_at 2011_02_02, updated_at 2020_04_23;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS User-Agent (ChilkatUpload)"; flow:to_server,established; http.user_agent; content:"ChilkatUpload"; depth:13; nocase; reference:url,chilkatsoft.com; classtype:trojan-activity; sid:2016904; rev:4; metadata:created_at 2013_05_21, updated_at 2020_04_24;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS EmailSiphon Suspicious User-Agent Outbound"; flow:established,to_server; http.user_agent; content:"EmailSiphon"; nocase; depth:11; reference:url,www.useragentstring.com/pages/useragentstring.php; classtype:attempted-recon; sid:2013033; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_06_14, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_04_24;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious user agent (Google page)"; flow:to_server,established; http.header; content:"User-Agent|3a 20|Google page"; classtype:trojan-activity; sid:2017067; rev:6; metadata:created_at 2011_05_31, updated_at 2020_04_24;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Unknown - Java Request  - gt 60char hex-ascii"; flow:established,to_server; urilen:>60; http.uri; pcre:"/[\/\?][a-z0-9]{60,66}[\;0-9]/i"; http.user_agent; content:"Java/1."; fast_pattern; content:"Mozilla"; depth:7; classtype:trojan-activity; sid:2014912; rev:7; metadata:created_at 2012_06_16, former_category CURRENT_EVENTS, updated_at 2022_05_03;)

            alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ET USER_AGENTS FOCA User-Agent"; flow:established,to_server; http.method; content:"GET"; http.header_names; content:!"Referer|0d 0a|"; content:!"Accept|0d 0a|"; http.header; content:"User-Agent|3a 20|FOCA"; fast_pattern; reference:url,blog.bannasties.com/2013/08/vulnerability-scans/; classtype:attempted-recon; sid:2017949; rev:6; metadata:created_at 2014_01_10, updated_at 2020_04_27;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS BeeMovie Related Activity"; flow:to_server,established; http.header; content:"User-Agent|3a 20|BeeMovie/"; classtype:misc-activity; sid:2030050; rev:2; metadata:affected_product Android, attack_target Client_Endpoint, created_at 2020_04_29, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2020_04_29;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (h55u4u4u5uii5)"; flow:established,to_server; http.user_agent; content:"h55u4u4u5uii5"; bsize:13; reference:url,www.welivesecurity.com/2020/04/28/grandoreiro-how-engorged-can-exe-get/; classtype:trojan-activity; sid:2030058; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_04_29, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_04_29;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (DownloadMR)"; flow:to_server,established; http.user_agent; content:"DownloadMR"; nocase; depth:10; reference:url,www.virustotal.com/en/file/93236b781e147e3ac983be1374a5f807fabd27ee2b92e6d99e293a6eb070ac2b/analysis/; reference:md5,0da0d8e664f44400c19898b4c9e71456; classtype:trojan-activity; sid:2016903; rev:6; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2013_05_21, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_04_29;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (hi)"; flow:established,to_server; http.header; content:"User-Agent|3a 20|hi|0d 0a|"; nocase; classtype:trojan-activity; sid:2018381; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2014_04_10, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_04_29;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Possible QBot User-Agent"; flow:established,to_server; http.user_agent; bsize:14; content:"MelindaMelinda"; reference:md5,d5129d51bf982b055ee00fe7ef4da3c0; classtype:trojan-activity; sid:2030149; rev:1; metadata:created_at 2020_05_11, updated_at 2020_05_11;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (MSIE)"; flow:established,to_server; http.user_agent; content:"MSIE|28|6.00.2900.5512|20 28|"; fast_pattern; content:"|3b 20|NT|28|"; distance:0; content:"|29 3b 20|AV|28|"; distance:0; content:"|29 3b 20|OV|28|"; distance:0; content:"|29 3b 20|NA|28|"; distance:0; content:"VR|28|PH"; reference:url,documents.trendmicro.com/assets/Tech-Brief-Tropic-Trooper-s-Back-USBferry-Attack-Targets-Air-gapped-Environments.pdf; classtype:trojan-activity; sid:2030170; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_05_15, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_08_10;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS MSF Meterpreter Default User Agent"; flow:established,to_server; http.header; content:"User-Agent|3a 20|Mozilla/4.0 (compatible|3b 20|MSIE 6.1|3b 20|Windows NT|29 0d 0a|"; fast_pattern; reference:url,blog.didierstevens.com/2015/03/16/quickpost-metasploit-user-agent-strings; classtype:bad-unknown; sid:2021060; rev:3; metadata:created_at 2015_05_06, updated_at 2020_05_21;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (CODE)"; flow:established,to_server; http.header; content:"User-Agent|3a 20|CODE|0d 0a|"; fast_pattern; reference:md5,f5ee4c578976587586202c15e98997ed; classtype:bad-unknown; sid:2030439; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2020_07_01, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_07_01;)

            alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ET USER_AGENTS BLEXBot User-Agent"; flow:established,to_server; threshold:type limit, track by_dst, count 1, seconds 300; http.user_agent; content:"Mozilla/5.0 (compatible|3b 20|BLEXBot/"; fast_pattern; startswith; reference:url,webmeup.com/about.html; classtype:misc-activity; sid:2022775; rev:3; metadata:created_at 2016_05_02, former_category MALWARE, updated_at 2020_07_07;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (grab)"; flow:established,to_server; http.header; content:"User-Agent|3a 20|grab|0d 0a|"; classtype:bad-unknown; sid:2030492; rev:1; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2020_07_10, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_07_10;)

            alert http $EXTERNAL_NET any -> any any (msg:"ET USER_AGENTS SAP CVE-2020-6287 PoC UA Observed"; flow:established,to_server; http.user_agent; content:"CVE-2020-6287|20|PoC"; endswith; fast_pattern; reference:url,github.com/chipik/SAP_RECON/blob/master/RECON.py; classtype:attempted-recon; sid:2030548; rev:1; metadata:created_at 2020_07_16, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_07_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (justupdate)"; flow:established,to_server; http.user_agent; bsize:10; content:"justupdate"; reference:md5,7a814300b204e14467deff69c1159cbe; classtype:bad-unknown; sid:2030556; rev:1; metadata:created_at 2020_07_17, former_category USER_AGENTS, updated_at 2020_07_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (.NET Framework Client)"; flow:established,to_server; http.header; content:"User-Agent|3a 20|.NET Framework Client|0d 0a|"; classtype:bad-unknown; sid:2030586; rev:1; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2020_07_24, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2022_04_18;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (cctv.mtv)"; flow:established,to_server; http.user_agent; bsize:8; content:"cctv.mtv"; reference:md5,deffb804976c0531144d999ded0df8b9; classtype:bad-unknown; sid:2030598; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_07_27, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_07_27;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (cso)"; flow:established,to_server; http.user_agent; content:"cso v"; startswith; fast_pattern; pcre:"/^[0-9][0-9]?\.[0-9][0-9]?$/R"; reference:md5,5640851c35221c3ae7bbde053d1bb38e; reference:url,app.any.run/tasks/d94c1428-253d-432a-be65-53ea3a0505f4/; classtype:trojan-activity; sid:2030600; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_07_27, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_07_27;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (firefox)"; flow:established,to_server; http.user_agent; content:"firefox"; bsize:7; fast_pattern; reference:url,unit42.paloaltonetworks.com/oilrig-novel-c2-channel-steganography/; classtype:trojan-activity; sid:2030623; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_07_30, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2020_07_30;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (chrome)"; flow:established,to_server; http.user_agent; content:"chrome"; bsize:6; fast_pattern; reference:url,unit42.paloaltonetworks.com/oilrig-novel-c2-channel-steganography/; classtype:trojan-activity; sid:2030624; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_07_30, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2020_07_30;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Microsoft Edge on Windows 10 SET"; flow:established,to_server; flowbits:set,ET_EDGE_UA; flowbits:noalert; http.user_agent; content:"Windows NT 10."; content:"Edge/12."; distance:0; fast_pattern; classtype:misc-activity; sid:2023197; rev:5; metadata:affected_product Microsoft_Edge_Browser, created_at 2016_09_13, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, tag User_Agent, updated_at 2020_08_05;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Go HTTP Client User-Agent"; flow:established,to_server; http.user_agent; content:"Go-http-client"; nocase; fast_pattern; classtype:misc-activity; sid:2024897; rev:2; metadata:attack_target Client_Endpoint, created_at 2017_10_23, deployment Perimeter, former_category USER_AGENTS, signature_severity Major, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent - Possible Trojan Downloader (ver18/ver19 etc)"; flow:established,to_server; http.user_agent; content:")ver"; fast_pattern; pcre:"/\)ver\d/"; reference:url,doc.emergingthreats.net/2003380; classtype:trojan-activity; sid:2003380; rev:13; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, tag Trojan_Downloader, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS User-agent DownloadNetFile Win32.small.hsh downloader"; flow:established,to_server; http.method; content:"GET"; nocase; http.user_agent; content:"DownloadNetFile"; nocase; bsize:15; reference:url,doc.emergingthreats.net/2007778; classtype:trojan-activity; sid:2007778; rev:15; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (chek)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"chek"; depth:4; reference:url,doc.emergingthreats.net/bin/view/Main/2008253; classtype:trojan-activity; sid:2008253; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (AutoHotkey)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.header; content:!".ahk4.net|0d 0a|"; http.user_agent; content:"AutoHotkey"; depth:10; reference:url,doc.emergingthreats.net/bin/view/Main/2008259; classtype:trojan-activity; sid:2008259; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (contains loader)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"|20|loader"; fast_pattern; reference:url,doc.emergingthreats.net/bin/view/Main/2008276; classtype:trojan-activity; sid:2008276; rev:16; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (ErrCode)"; flow:established,to_server; http.user_agent; content:"ErrCode"; reference:url,doc.emergingthreats.net/bin/view/Main/2008378; classtype:trojan-activity; sid:2008378; rev:13; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Loands) - Possible Trojan Downloader GET Request"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.header; content:"User-Agent\: Loands|0d 0a|"; reference:url,doc.emergingthreats.net/2009537; classtype:trojan-activity; sid:2009537; rev:9; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, tag Trojan_Downloader, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (ms_ie) - Crypt.ZPACK Gen Trojan Downloader GET Request"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.header; content:"User-Agent\: ms_ie|0d 0a|"; nocase; reference:url,doc.emergingthreats.net/2009538; classtype:trojan-activity; sid:2009538; rev:7; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, tag Trojan_Downloader, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Forthgoner) - Possible Trojan Downloader GET Request"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.header; content:"User-Agent\: Forthgoner|0d 0a|"; nocase; reference:url,doc.emergingthreats.net/2009547; classtype:trojan-activity; sid:2009547; rev:7; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, tag Trojan_Downloader, updated_at 2022_05_03;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Si25f_302 User-Agent"; flow:established,to_server; http.user_agent; content:"Si25"; depth:4; classtype:trojan-activity; sid:2012310; rev:7; metadata:created_at 2011_02_14, former_category TROJAN, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Im Luo"; flow:established,to_server; http.user_agent; content:"Im|27|Luo"; startswith; classtype:trojan-activity; sid:2012586; rev:6; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_03_28, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS MacShield User-Agent Likely Malware"; flow:established,to_server; http.user_agent; content:"MacShield"; startswith; reference:url,blog.spiderlabs.com/2011/06/analysis-and-evolution-of-macdefender-os-x-fake-av-scareware.html; classtype:trojan-activity; sid:2012959; rev:5; metadata:created_at 2011_06_09, former_category TROJAN, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent _updater_agent"; flow:established,to_server; http.header; content:"User-Agent|3A 20|_updater_agent"; classtype:trojan-activity; sid:2013395; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_08_10, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (MadeByLc)"; flow:established,to_server; http.user_agent; content:"MadeBy"; startswith; classtype:trojan-activity; sid:2013512; rev:5; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_08_31, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS W32/OnlineGames User-Agent (LockXLS)"; flow:established,to_server; http.user_agent; content:"LockXLS"; startswith; classtype:trojan-activity; sid:2013724; rev:4; metadata:created_at 2011_10_01, former_category TROJAN, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (FULLSTUFF)"; flow: established,to_server; http.user_agent; content:"FULLSTUFF"; nocase; startswith; reference:url,threatexpert.com/reports.aspx?find=mrb.mail.ru; classtype:trojan-activity; sid:2013880; rev:5; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_11_08, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (HardCore Software For)"; flow:to_server,established; http.user_agent; content:"HardCore Software For"; depth:21; nocase; classtype:trojan-activity; sid:2018608; rev:6; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_07_06, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_08_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (App4)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"App"; depth:3; fast_pattern; pcre:"/^\d/R"; http.host; content:!"liveupdate.symantecliveupdate.com"; reference:url,doc.emergingthreats.net/bin/view/Main/2008073; classtype:trojan-activity; sid:2008073; rev:16; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Presto)"; flow:established,to_server; http.user_agent; content:"Opera/10.60 Presto/2.2.30"; http.header_names; content:!"Accept"; classtype:trojan-activity; sid:2012491; rev:9; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_03_12, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_08_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS WildTangent User-Agent (WT Games App)"; flow:established,to_server; http.header; content:"|0d 0a|WT-User-Agent|3a 20|WT|20|Games|20|App|20|"; classtype:policy-violation; sid:2021384; rev:3; metadata:created_at 2015_07_07, updated_at 2020_08_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Our_Agent)"; flow:established,to_server; http.user_agent; content:"Our_Agent"; classtype:trojan-activity; sid:2012278; rev:7; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_02_03, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_08_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (ClickAdsByIE)"; flow:to_server,established; http.user_agent; content:"ClickAdsByIE"; depth:12; reference:url,doc.emergingthreats.net/2010220; classtype:pup-activity; sid:2010220; rev:8; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Long Fake wget 3.0 User-Agent Detected"; flow:established,to_server; http.user_agent; content:"wget 3.0"; classtype:trojan-activity; sid:2013178; rev:6; metadata:created_at 2011_07_04, former_category TROJAN, updated_at 2020_08_18;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Ufasoft bitcoin Related User-Agent"; flow:established,to_server; http.user_agent; content:"Ufasoft"; depth:7; classtype:trojan-activity; sid:2013391; rev:6; metadata:created_at 2011_08_10, former_category TROJAN, updated_at 2020_08_18;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (MSIE)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"MSIE"; depth:4; http.host; content:!"www.msftncsi.com"; reference:url,doc.emergingthreats.net/bin/view/Main/2003657; classtype:trojan-activity; sid:2003657; rev:19; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_18;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (explorersvc)"; flow:established,to_server; http.user_agent; bsize:11; content:"explorersvc"; classtype:bad-unknown; sid:2029749; rev:2; metadata:attack_target Client_Endpoint, created_at 2020_03_27, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_08_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (KtulhuBrowser)"; flow:established,to_server; http.user_agent; bsize:13; content:"KtulhuBrowser"; nocase; classtype:bad-unknown; sid:2029750; rev:2; metadata:attack_target Client_Endpoint, created_at 2020_03_27, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_08_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspected Mekotio User-Agent (MyCustomUser)"; flow:established,to_server; http.user_agent; content:"MyCustomUser"; bsize:12; fast_pattern; reference:url,www.welivesecurity.com/2020/08/13/mekotio-these-arent-the-security-updates-youre-looking-for/; classtype:trojan-activity; sid:2030721; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_08_21, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_08_21;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspected Mekotio User-Agent (4M5yC6u4stom5U8se3r)"; flow:established,to_server; http.user_agent; content:"4M5yC6u4stom5U8se3r"; bsize:19; fast_pattern; reference:url,www.welivesecurity.com/2020/08/13/mekotio-these-arent-the-security-updates-youre-looking-for/; classtype:trojan-activity; sid:2030722; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_08_21, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_08_21;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (=Mozilla)"; flow:established,to_server; http.header; content:"User-Agent|3a|=Mozilla/5"; fast_pattern; classtype:trojan-activity; sid:2025456; rev:3; metadata:affected_product Web_Browsers, attack_target Client_and_Server, created_at 2018_03_27, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_08_25;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (InfoBot)"; flow:to_server,established; http.user_agent; content:"InfoBot"; nocase; reference:url,doc.emergingthreats.net/2011276; classtype:trojan-activity; sid:2011276; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_08_25;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (HTTP_CONNECT_)"; flow:established,to_server; http.user_agent; content:"HTTP_Connect_"; depth:13; reference:url,doc.emergingthreats.net/bin/view/Main/2007821; classtype:bad-unknown; sid:2007821; rev:8; metadata:attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, tag Spyware_User_Agent, updated_at 2020_08_25;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Windows XP)"; flow:to_server,established; http.user_agent; content:"Windows XP"; depth:10; classtype:bad-unknown; sid:2026519; rev:2; metadata:affected_product Web_Browsers, attack_target Client_Endpoint, created_at 2018_10_18, deployment Perimeter, former_category HUNTING, signature_severity Minor, updated_at 2020_08_26;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Windows 8)"; flow:to_server,established; http.user_agent; content:"Windows 8"; depth:9; classtype:bad-unknown; sid:2026520; rev:2; metadata:affected_product Web_Browsers, attack_target Client_Endpoint, created_at 2018_10_18, deployment Perimeter, former_category HUNTING, signature_severity Minor, updated_at 2020_08_26;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Windows 7)"; flow:to_server,established; http.user_agent; content:"Windows 7"; depth:9; classtype:bad-unknown; sid:2026522; rev:2; metadata:affected_product Web_Browsers, attack_target Client_Endpoint, created_at 2018_10_18, deployment Perimeter, former_category HUNTING, signature_severity Minor, updated_at 2020_08_26;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS SFML User-Agent (libsfml-network)"; flow:established,to_server; http.user_agent; content:"libsfml-network/"; depth:16; fast_pattern; reference:url,github.com/SFML; classtype:trojan-activity; sid:2026914; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_02_14, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2020_08_27;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Clever Internet Suite)"; flow:established,to_server; http.user_agent; content:"Clever Internet Suite"; classtype:trojan-activity; sid:2027045; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, created_at 2019_03_05, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Major, updated_at 2020_08_28;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (boostsoftware-urlexists)"; flow:established,to_server; http.user_agent; bsize:23; content:"boostsoftware-urlexists"; classtype:bad-unknown; sid:2030814; rev:2; metadata:attack_target Client_Endpoint, created_at 2020_08_28, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2020_08_28;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Aria2 User-Agent"; flow:to_server,established; http.user_agent; content:"aria2/"; depth:6; fast_pattern; reference:url,github.com/aria2/aria2; reference:md5,eb042fe28b8a235286df2c7f4ed1d8a8; classtype:trojan-activity; sid:2027286; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_04_25, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2020_08_28;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Fake Mozilla User-Agent String Observed (M0zilla)"; flow:established,to_server; http.user_agent; content:"M0zilla|2f|"; depth:8; fast_pattern; content:"."; distance:1; within:1; reference:md5,c6c1292bf7dd1573b269afb203134b1d; classtype:trojan-activity; sid:2027565; rev:2; metadata:created_at 2019_06_26, former_category USER_AGENTS, updated_at 2020_08_31;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (NSIS_Inetc (Mozilla))"; flow:established,to_server; http.user_agent; content:"NSIS|5f|Inetc|20 28|Mozilla|29|"; reference:url,doc.emergingthreats.net/2011227; classtype:bad-unknown; sid:2011227; rev:7; metadata:attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Minor, updated_at 2020_08_31;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (Microsoft Internet Explorer)"; flow:established,to_server; threshold:type limit, track by_src, count 2, seconds 360; http.user_agent; content:"Microsoft Internet Explorer"; depth:28; http.host; content:!"bbc.co.uk"; content:!"vmware.com"; content:!"rc.itsupport247.net"; content:!"msn.com"; content:!"msn.es"; content:!"live.com"; content:!"gocyberlink.com"; content:!"ultraedit.com"; content:!"windowsupdate.com"; content:!"cyberlink.com"; content:!"lenovo.com"; content:!"itsupport247.net"; content:!"msn.co.uk"; content:!"support.weixin.qq.com"; reference:url,doc.emergingthreats.net/bin/view/Main/2002400; classtype:trojan-activity; sid:2002400; rev:37; metadata:created_at 2010_07_30, former_category HUNTING, updated_at 2020_08_31;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS User-Agent (_TEST_)"; flow: to_server,established; http.user_agent; content:"_TEST_"; nocase; reference:url,doc.emergingthreats.net/2009545; classtype:unknown; sid:2009545; rev:11; metadata:created_at 2010_07_30, former_category ADWARE_PUP, updated_at 2020_08_31;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Microsoft Windows Vista UA - Commonly Abused"; flow:established,to_server; http.user_agent; content:"Mozilla/4.0 (compatible|3b 20|MSIE 7.0b|3b 20|Windows NT 6.0)"; fast_pattern; classtype:misc-activity; sid:2030847; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2020_09_08, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_09_08;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Session) - Possible Trojan-Clicker"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"Session"; depth:7; endswith; nocase; reference:url,doc.emergingthreats.net/2009512; classtype:trojan-activity; sid:2009512; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_09_14;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Installer)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"Installer"; depth:9; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008184; classtype:trojan-activity; sid:2008184; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_09_14;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (API-Guide test program) Used by Several trojans"; flow:established,to_server; http.user_agent; content:"API-Guide test program"; depth:22; nocase; endswith; reference:url,doc.emergingthreats.net/2007826; classtype:trojan-activity; sid:2007826; rev:9; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_09_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Mozilla/3.0"; flow:established,to_server; http.user_agent; content:"Mozilla/3.0"; fast_pattern; depth:11; endswith; classtype:trojan-activity; sid:2012619; rev:9; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_04_01, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_09_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Detected (RLMultySocket)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"RLMultySocket"; depth:13; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008603; classtype:trojan-activity; sid:2008603; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_09_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Downloader User-Agent HTTPGET"; flow:established,to_server; http.user_agent; content:"HTTPGET"; depth:7; http.host; content:!"autodesk.com"; endswith; content:!"rsa.com"; endswith; content:!"consumersentinel.gov"; endswith; content:!"technet.microsoft.com"; endswith; content:!"metropolis.com"; endswith; content:!"www.catalog.update.microsoft.com"; endswith; classtype:trojan-activity; sid:2013508; rev:14; metadata:created_at 2011_08_31, former_category TROJAN, updated_at 2020_09_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Win32/Feebs.kw Worm User-Agent Detected"; flow:established,to_server; http.user_agent; content:"Mozilla/4.7 [en] (WinNT"; depth:23; fast_pattern; reference:url,doc.emergingthreats.net/2007767; classtype:trojan-activity; sid:2007767; rev:9; metadata:created_at 2010_07_30, former_category USER_AGENTS, updated_at 2020_09_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Installed OK)"; flow:established,to_server; http.user_agent; content:"Installed OK"; startswith; nocase; reference:md5,16035440878ec6e93d82c2aeea508630; classtype:bad-unknown; sid:2030880; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_09_15, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2020_09_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Mozilla/3.0 (compatible))"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"Mozilla/3.0 (compatible)"; depth:24; endswith; http.host; content:!".hddstatus.com"; endswith; reference:url,doc.emergingthreats.net/2009867; classtype:trojan-activity; sid:2009867; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS VPNFilter Related UA (Gemini/2.0)"; flow:established,to_server; http.user_agent; content:"Gemini/2.0"; depth:10; fast_pattern; endswith; reference:url,twitter.com/m0rb/status/1021626709307805696; classtype:trojan-activity; sid:2025889; rev:3; metadata:attack_target Server, created_at 2018_07_25, deployment Perimeter, former_category USER_AGENTS, malware_family VPNFilter, performance_impact Low, signature_severity Major, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS VPNFilter Related UA (Hakai/2.0)"; flow:established,to_server; http.user_agent; content:"Hakai/2.0"; depth:9; fast_pattern; endswith; reference:url,twitter.com/m0rb/status/1021626709307805696; classtype:trojan-activity; sid:2025890; rev:4; metadata:attack_target Server, created_at 2018_07_25, deployment Perimeter, former_category USER_AGENTS, malware_family VPNFilter, performance_impact Low, signature_severity Major, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS MSIL/Peppy User-Agent"; flow:established,to_server; http.user_agent; content:"onedru/"; depth:7; endswith; fast_pattern; reference:md5,ebffb046d0e12b46ba5f27c0176b01c5; classtype:trojan-activity; sid:2026101; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2018_09_07, deployment Perimeter, former_category USER_AGENTS, malware_family Peppy, performance_impact Moderate, signature_severity Major, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS VPNFilter Related UA (curl53)"; flow:established,to_server; http.user_agent; content:"curl53"; depth:6; fast_pattern; endswith; reference:url,blog.talosintelligence.com/2018/09/vpnfilter-part-3.html; classtype:trojan-activity; sid:2026428; rev:4; metadata:affected_product Linux, attack_target Networking_Equipment, created_at 2018_10_01, deployment Perimeter, former_category USER_AGENTS, malware_family VPNFilter, signature_severity Major, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Windows 10)"; flow:to_server,established; http.user_agent; content:"Windows 10"; depth:10; http.host; content:!"google-analytics.com"; endswith; classtype:bad-unknown; sid:2026521; rev:4; metadata:affected_product Web_Browsers, attack_target Client_Endpoint, created_at 2018_10_18, deployment Perimeter, former_category HUNTING, signature_severity Minor, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious UA Observed (IEhook)"; flow:established,to_server; http.user_agent; content:"IEhook"; depth:6; endswith; fast_pattern; reference:md5,f0483493bcb352bd2f474b52f3b2f273; classtype:trojan-activity; sid:2026558; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2018_10_26, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, tag User_Agent, updated_at 2020_09_16;)

            alert http any any -> $HOME_NET any (msg:"ET USER_AGENTS WinRM User Agent Detected - Possible Lateral Movement"; flow:established,to_server; http.user_agent; content:"Microsoft|20|WinRM|20|Client"; depth:22; fast_pattern; endswith; reference:url,attack.mitre.org/techniques/T1028/; classtype:bad-unknown; sid:2026850; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_and_Server, created_at 2019_01_23, deployment Internal, former_category USER_AGENTS, performance_impact Low, signature_severity Major, tag WinRM, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Peppy/KeeOIL Google User-Agent (google/dance)"; flow:established,to_server; http.user_agent; content:"google/dance"; depth:14; fast_pattern; endswith; reference:url,www.malcrawler.com/team-simbaa-targets-indian-government-using-united-nations-military-observers-themed-malware-nicked-named-keeoil/; classtype:trojan-activity; sid:2026883; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_02_05, deployment Perimeter, former_category USER_AGENTS, malware_family Peppy, malware_family KeeOIL, performance_impact Low, signature_severity Major, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Peppy/KeeOIL User-Agent (ekeoil)"; flow:established,to_server; http.user_agent; content:"ekeoil/"; depth:7; fast_pattern; endswith; reference:url,www.malcrawler.com/team-simbaa-targets-indian-government-using-united-nations-military-observers-themed-malware-nicked-named-keeoil/; classtype:trojan-activity; sid:2026885; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_02_05, deployment Perimeter, former_category USER_AGENTS, malware_family Peppy, malware_family KeeOIL, performance_impact Low, signature_severity Major, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (SomeTimes)"; flow:established,to_server; http.user_agent; content:"SomeTimes"; depth:9; endswith; fast_pattern; reference:md5,a86d4e17389a37bfc291f4a8da51a9b8; classtype:trojan-activity; sid:2026898; rev:3; metadata:attack_target Client_Endpoint, created_at 2019_02_11, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, tag User_Agent, updated_at 2020_09_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (Mozilla 6.0)"; flow:established,to_server; http.user_agent; content:"Mozilla 6.0"; depth:11; endswith; classtype:bad-unknown; sid:2027142; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_04_01, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Microsoft Device Metadata Retrieval Client User-Agent"; flow:established,to_server; http.user_agent; content:"MICROSOFT_DEVICE_METADATA_RETRIEVAL_CLIENT"; depth:42; endswith; nocase; fast_pattern; classtype:misc-activity; sid:2027390; rev:4; metadata:affected_product Web_Browsers, attack_target Client_Endpoint, created_at 2019_05_28, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Node XMLHTTP User-Agent"; flow:established,to_server; http.user_agent; content:"node-XMLHttpRequest"; depth:19; endswith; nocase; fast_pattern; classtype:unknown; sid:2027388; rev:4; metadata:affected_product Web_Browsers, attack_target Client_Endpoint, created_at 2019_05_28, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious UA Observed (YourUserAgent)"; flow:established,to_server; http.user_agent; content:"YourUserAgent"; depth:13; fast_pattern; endswith; reference:md5,c1ca718e7304bf28b5c96559cbf69a06; classtype:bad-unknown; sid:2027484; rev:3; metadata:created_at 2019_06_17, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Minor, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (Hello, World)"; flow:established,to_server; http.user_agent; content:"Hello, World"; depth:12; endswith; classtype:bad-unknown; sid:2027503; rev:3; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2019_06_21, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Informational, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (Hello-World)"; flow:established,to_server; http.user_agent; content:"Hello-World"; depth:11; endswith; classtype:bad-unknown; sid:2027504; rev:3; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2019_06_21, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Informational, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious UA Observed (Ave, Caesar!)"; flow:established,to_server; http.user_agent; content:"Ave,|20|Caesar!"; depth:12; fast_pattern; endswith; classtype:bad-unknown; sid:2027648; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, created_at 2019_06_28, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Major, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (zwt)"; flow:established,to_server; http.user_agent; content:"zwt"; depth:3; endswith; classtype:bad-unknown; sid:2027649; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_07_01, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Informational, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (My Agent)"; flow:established,to_server; http.user_agent; content:"My Agent"; depth:8; endswith; classtype:bad-unknown; sid:2027650; rev:3; metadata:attack_target Client_Endpoint, created_at 2019_07_01, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Informational, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious Custom Firefox UA Observed (Firefox...)"; flow:established,to_server; http.user_agent; content:"Firefox..."; depth:10; fast_pattern; endswith; classtype:bad-unknown; sid:2027686; rev:3; metadata:created_at 2019_07_04, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Minor, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS User-Agent (single dash)"; flow:to_server,established; http.user_agent; content:"-"; depth:1; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2007880; classtype:trojan-activity; sid:2007880; rev:10; metadata:created_at 2010_07_30, former_category MALWARE, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious UA Observed (Quick Macros)"; flow:established,to_server; http.user_agent; content:"Quick|20|Macros"; depth:12; endswith; reference:md5,aa682f5d4a17307539a2bc7048be0745; classtype:trojan-activity; sid:2027755; rev:3; metadata:created_at 2019_07_24, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Minor, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (agent)"; flow:established,to_server; http.header; content:!"cn.patch.battlenet.com.cn"; http.user_agent; content:"agent"; depth:5; http.host; content:!".battle.net"; content:!".blizzard.com"; endswith; content:!"blz"; depth:3; reference:url,doc.emergingthreats.net/bin/view/Main/2001891; classtype:trojan-activity; sid:2001891; rev:24; metadata:created_at 2010_07_30, former_category HUNTING, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious Generic Style UA Observed (My_App)"; flow:established,to_server; http.user_agent; content:"My_App"; depth:6; fast_pattern; endswith; reference:md5,2978dbadd8fda7d842298fbd476b47b2; classtype:bad-unknown; sid:2027833; rev:4; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, created_at 2019_08_09, former_category HUNTING, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Mozilla/4.0 (compatible ICS))"; flow:established,to_server; http.user_agent; content:"Mozilla/4.0 (compatible|3b 20|ICS)"; depth:29; endswith; http.host; content:!".iobit.com"; content:!".microsoft.com"; content:!".cnn.com"; content:!".wunderground.com"; content:!".weatherbug.com"; content:!"iobit.com.s3.amazonaws.com"; reference:url,doc.emergingthreats.net/bin/view/Main/2008038; classtype:pup-activity; sid:2008038; rev:15; metadata:created_at 2010_07_30, former_category HUNTING, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (My Session)"; flow:to_server,established; http.user_agent; content:"My Session"; nocase; depth:10; http.host; content:!".windows.net"; endswith; reference:url,doc.emergingthreats.net/2010677; classtype:pup-activity; sid:2010677; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (Absent)"; flow:established,to_server; http.user_agent; content:"Absent"; depth:6; endswith; classtype:bad-unknown; sid:2028571; rev:3; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2019_09_12, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Informational, updated_at 2020_09_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS User-Agent (Internet Explorer)"; flow:established,to_server; http.user_agent; content:"Internet Explorer"; depth:17; endswith; nocase; http.host; content:!"pnrws.skype.com"; content:!"iecvlist.microsoft.com"; content:!".lenovo.com"; reference:url,doc.emergingthreats.net/bin/view/Main/2008052; classtype:bad-unknown; sid:2008052; rev:20; metadata:created_at 2010_07_30, former_category ADWARE_PUP, updated_at 2020_10_05;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS SideStep User-Agent"; flow: to_server,established; http.user_agent; content:"SideStep"; reference:url,doc.emergingthreats.net/2002078; reference:url,github.com/chetan51/sidestep/; classtype:misc-activity; sid:2002078; rev:32; metadata:attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, performance_impact Low, signature_severity Minor, tag User_Agent, updated_at 2020_10_08;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Moxilla"; flow:established,to_server; http.user_agent; content:"Moxilla"; depth:7; classtype:trojan-activity; sid:2012313; rev:7; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_02_14, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (VMozilla)"; flow:to_server,established; http.user_agent; content:"VMozilla"; depth:8; nocase; reference:url,www.microsoft.com/security/portal/Threat/Encyclopedia/Entry.aspx?Name=Worm%3aWin32%2fNeeris.BF; reference:url,www.avira.com/en/support-threats-description/tid/6259/tlang/en; classtype:trojan-activity; sid:2012555; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_03_25, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS suspicious User Agent (Lotto)"; flow:to_server,established; http.user_agent; content:"Lotto"; depth:5; classtype:trojan-activity; sid:2012695; rev:4; metadata:created_at 2011_04_20, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious user agent (mdms)"; flow:to_server,established; http.method; content:"GET"; http.user_agent; content:"mdms"; depth:4; endswith; classtype:trojan-activity; sid:2012761; rev:4; metadata:created_at 2011_05_03, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious user agent (asd)"; flow:to_server,established; http.method; content:"GET"; http.user_agent; content:"asd"; nocase; depth:3; endswith; classtype:trojan-activity; sid:2012762; rev:4; metadata:created_at 2011_05_03, updated_at 2020_10_13;)

            alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ET USER_AGENTS EmailSiphon Suspicious User-Agent Inbound"; flow:established,to_server; http.user_agent; content:"EmailSiphon"; nocase; depth:11; reference:url,www.useragentstring.com/pages/useragentstring.php; classtype:attempted-recon; sid:2013032; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_06_14, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Binget PHP Library User Agent Outbound"; flow:established,to_server; http.user_agent; content:"Binget/"; nocase; depth:7; reference:url,www.bin-co.com/php/scripts/load/; reference:url,www.useragentstring.com/pages/useragentstring.php; classtype:attempted-recon; sid:2013050; rev:4; metadata:created_at 2011_06_17, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS pxyscand/ Suspicious User Agent Outbound"; flow:established,to_server; http.user_agent; content:"pxyscand/"; nocase; depth:9; reference:url,www.useragentstring.com/pages/useragentstring.php; classtype:attempted-recon; sid:2013052; rev:4; metadata:created_at 2011_06_17, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS PyCurl Suspicious User Agent Outbound"; flow:established,to_server; http.user_agent; content:"PyCurl"; nocase; depth:6; reference:url,www.useragentstring.com/pages/useragentstring.php; classtype:attempted-recon; sid:2013054; rev:4; metadata:created_at 2011_06_17, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent String (AskPartnerCobranding)"; flow:to_server,established; http.user_agent; content:"AskPartner"; depth:10; classtype:trojan-activity; sid:2012734; rev:6; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_04_28, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (BlackSun)"; flow:to_server,established; http.user_agent; content:"BlackSun"; nocase; depth:8; reference:url,www.bitdefender.com/VIRUS-1000328-en--Trojan.Pws.Wow.NCY.html; reference:url,doc.emergingthreats.net/bin/view/Main/2008983; classtype:trojan-activity; sid:2008983; rev:8; metadata:created_at 2010_07_30, former_category HUNTING, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (AskInstallChecker)"; flow:to_server,established; http.method; content:"GET"; http.user_agent; content:"AskInstall"; depth:10; nocase; reference:url,doc.emergingthreats.net/2011225; classtype:policy-violation; sid:2011225; rev:8; metadata:created_at 2010_07_30, former_category HUNTING, updated_at 2020_10_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (XXX) Often Sony Update Related"; flow:established,to_server; http.user_agent; content:"XXX"; depth:3; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2010157; classtype:not-suspicious; sid:2010157; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Informational, tag User_Agent, updated_at 2020_10_14;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (USERAGENT)"; flow:to_server,established; http.user_agent; content:"USERAGENT"; nocase; depth:9; endswith; reference:md5,cd0e98508657b208219d435f9ac9d76c; reference:md5,cd100abc8eedf2119c7e6746975d7773; classtype:trojan-activity; sid:2034066; rev:7; metadata:created_at 2011_11_22, former_category USER_AGENTS, updated_at 2020_10_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS User-Agent (Unknown)"; flow:to_server,established; http.user_agent; content:"Unknown"; depth:7; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2007991; classtype:trojan-activity; sid:2007991; rev:10; metadata:created_at 2010_07_30, former_category MALWARE, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Metafisher/Goldun User-Agent (z)"; flow:to_server,established; http.user_agent; content:"z"; depth:1; endswith; reference:url,doc.emergingthreats.net/2002874; classtype:trojan-activity; sid:2002874; rev:17; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent outbound (bot)"; flow:to_server,established; threshold: type limit, count 3, seconds 300, track by_src; http.user_agent; content:"bot/"; depth:4; nocase; reference:url,doc.emergingthreats.net/bin/view/Main/2003622; classtype:trojan-activity; sid:2003622; rev:15; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (HTTPTEST) - Seen used by downloaders"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.header; content:!"PlayStation"; http.user_agent; content:"HTTPTEST"; nocase; depth:8; reference:url,doc.emergingthreats.net/bin/view/Main/2003927; classtype:trojan-activity; sid:2003927; rev:13; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Dialer-967 User-Agent"; flow:to_server,established; http.user_agent; content:"del"; depth:3; endswith; nocase; reference:url,doc.emergingthreats.net/2006364; classtype:trojan-activity; sid:2006364; rev:10; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (MYURL)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"MYURL"; depth:5; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2006365; classtype:trojan-activity; sid:2006365; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Downloader User-Agent Detected (Windows Updates Manager|3.12|...)"; flow:established,to_server; http.user_agent; content:"Windows Updates Manager|7c|"; depth:24; reference:url,doc.emergingthreats.net/2006387; classtype:trojan-activity; sid:2006387; rev:11; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Downloader User-Agent Detected (ld)"; flow:established,to_server; http.user_agent; content:"ld"; depth:2; endswith; reference:url,doc.emergingthreats.net/2006394; classtype:trojan-activity; sid:2006394; rev:10; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Tear Application User-Agent Detected"; flow:established,to_server; http.user_agent; content:"Tear Application"; depth:16; endswith; reference:url,doc.emergingthreats.net/2007770; classtype:trojan-activity; sid:2007770; rev:9; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent - Possible Trojan Downloader (WinInet)"; flow:established,to_server; http.user_agent; content:"WinInet"; depth:7; endswith; reference:url,doc.emergingthreats.net/2007837; classtype:trojan-activity; sid:2007837; rev:8; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, tag Trojan_Downloader, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Possible Trojan Downloader Shell"; flow:established,to_server; http.user_agent; content:"Shell"; depth:5; endswith; nocase; reference:url,doc.emergingthreats.net/2007840; reference:url,www.securelist.com/en/blog/434/The_Chinese_bootkit; classtype:trojan-activity; sid:2007840; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, tag Trojan_Downloader, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent - Possible Trojan Downloader (https)"; flow:established,to_server; http.user_agent; content:"https"; depth:5; endswith; nocase; reference:url,doc.emergingthreats.net/2008019; classtype:trojan-activity; sid:2008019; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, tag Trojan_Downloader, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Version 1.23)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"Version|20|"; depth:8; reference:url,doc.emergingthreats.net/bin/view/Main/2008048; classtype:trojan-activity; sid:2008048; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (INSTALLER)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"INSTALLER"; depth:9; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008096; classtype:trojan-activity; sid:2008096; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (IEMGR)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"IEMGR"; depth:5; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008097; classtype:trojan-activity; sid:2008097; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (GOOGLE)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"GOOGLE"; depth:6; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008098; classtype:trojan-activity; sid:2008098; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (RBR)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"RBR"; depth:3; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008147; classtype:trojan-activity; sid:2008147; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Otwycal User-Agent (Downing)"; flow:to_server,established; http.user_agent; content:"Downing"; depth:7; endswith; reference:url,doc.emergingthreats.net/2008159; classtype:trojan-activity; sid:2008159; rev:7; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (MS Internet Explorer)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"MS Internet Explorer"; depth:20; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008181; classtype:trojan-activity; sid:2008181; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (QQ)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.header; content:!"|0d 0a|Q-UA|3a 20|"; http.user_agent; content:"QQ"; depth:2; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008199; classtype:trojan-activity; sid:2008199; rev:20; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (SERVER2_03)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"SERVER"; depth:6; reference:url,doc.emergingthreats.net/bin/view/Main/2008209; classtype:trojan-activity; sid:2008209; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (WinProxy)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"WinProxy"; nocase; depth:8; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008211; classtype:trojan-activity; sid:2008211; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (sickness29a/0.1)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"sickness"; nocase; depth:8; reference:url,doc.emergingthreats.net/bin/view/Main/2008214; classtype:trojan-activity; sid:2008214; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (up2dash updater)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"up2dash"; nocase; depth:7; reference:url,doc.emergingthreats.net/bin/view/Main/2008215; classtype:trojan-activity; sid:2008215; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (NSIS_DOWNLOAD)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"NSIS_DOWNLOAD"; nocase; depth:13; reference:url,doc.emergingthreats.net/bin/view/Main/2008216; classtype:pup-activity; sid:2008216; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (IE)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"IE"; depth:2; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008255; classtype:trojan-activity; sid:2008255; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (WebForm 1)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"WebForm"; depth:7; reference:url,doc.emergingthreats.net/bin/view/Main/2008262; classtype:trojan-activity; sid:2008262; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (opera)"; flow:to_server,established; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"opera"; depth:5; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008264; classtype:trojan-activity; sid:2008264; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (123)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"123"; depth:3; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008343; classtype:trojan-activity; sid:2008343; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (angel)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"angel"; depth:5; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008355; classtype:trojan-activity; sid:2008355; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Accessing)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"Accessing"; depth:9; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008361; classtype:trojan-activity; sid:2008361; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (ISMYIE)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"ISMYIE"; depth:6; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008363; classtype:trojan-activity; sid:2008363; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (svchost)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"svchost"; depth:7; nocase; reference:url,doc.emergingthreats.net/bin/view/Main/2008391; classtype:trojan-activity; sid:2008391; rev:14; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (ReadFileURL)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"ReadFileURL"; depth:11; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008400; classtype:trojan-activity; sid:2008400; rev:13; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Inet_read)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"Inet_read"; depth:9; reference:url,doc.emergingthreats.net/bin/view/Main/2008422; classtype:trojan-activity; sid:2008422; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (CFS Agent)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"CFS Agent"; depth:9; reference:url,doc.emergingthreats.net/bin/view/Main/2008423; classtype:trojan-activity; sid:2008423; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (CFS_DOWNLOAD)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"CFS_DOWNLOAD"; depth:12; reference:url,doc.emergingthreats.net/bin/view/Main/2008424; classtype:trojan-activity; sid:2008424; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (HTTP Downloader)"; flow: established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"HTTP Downloader"; depth:15; reference:url,doc.emergingthreats.net/bin/view/Main/2008428; classtype:trojan-activity; sid:2008428; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (HttpDownload)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"HttpDownload"; depth:12; reference:url,doc.emergingthreats.net/bin/view/Main/2008429; classtype:trojan-activity; sid:2008429; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Download App)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"Download App"; depth:12; reference:url,doc.emergingthreats.net/bin/view/Main/2008440; classtype:trojan-activity; sid:2008440; rev:14; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Downloader User-Agent (AutoDL\/1.0)"; flow:established,to_server; http.method; content:"GET"; nocase; http.user_agent; content:"AutoDL/1.0"; depth:10; endswith; reference:url,doc.emergingthreats.net/2008458; classtype:trojan-activity; sid:2008458; rev:11; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (hacker)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"hacker"; depth:6; reference:url,doc.emergingthreats.net/bin/view/Main/2008460; classtype:trojan-activity; sid:2008460; rev:13; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (SUiCiDE/1.5)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"SUiCiDE"; depth:7; reference:url,doc.emergingthreats.net/bin/view/Main/2008504; classtype:trojan-activity; sid:2008504; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (msIE 7.0)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"msIE"; depth:4; reference:url,doc.emergingthreats.net/bin/view/Main/2008513; classtype:trojan-activity; sid:2008513; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (AVP2006IE)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"AVP200"; depth:6; reference:url,doc.emergingthreats.net/bin/view/Main/2008514; classtype:trojan-activity; sid:2008514; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (winlogon)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"winlogon"; depth:8; reference:url,doc.emergingthreats.net/bin/view/Main/2008544; classtype:trojan-activity; sid:2008544; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Internet HTTP Request)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"Internet HTTP"; depth:13; reference:url,doc.emergingthreats.net/bin/view/Main/2008564; classtype:trojan-activity; sid:2008564; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Detected (Downloader1.2)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"Downloader"; depth:10; pcre:"/^Downloader\d+\.\d/"; reference:url,doc.emergingthreats.net/bin/view/Main/2008643; classtype:trojan-activity; sid:2008643; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Detected (Compatible)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"Compatible"; depth:10; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008657; classtype:trojan-activity; sid:2008657; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Detected (GetUrlSize)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"GetUrlSize"; depth:10; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008658; classtype:trojan-activity; sid:2008658; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Detected (WINS_HTTP_SEND Program/1.0)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"WINS_HTTP_SEND"; depth:14; reference:url,doc.emergingthreats.net/bin/view/Main/2008734; classtype:trojan-activity; sid:2008734; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (checkonline)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"checkonline"; depth:11; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008749; classtype:trojan-activity; sid:2008749; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Kvadrlson 1.0)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"Kvadrlson|20|"; depth:10; reference:url,doc.emergingthreats.net/bin/view/Main/2008756; classtype:trojan-activity; sid:2008756; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (miip)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"miip"; depth:4; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008797; classtype:trojan-activity; sid:2008797; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Mozil1a)"; flow:established,to_server; threshold:type limit,count 2,track by_src,seconds 300; http.user_agent; content:"Mozil1a"; depth:7; reference:url,doc.emergingthreats.net/bin/view/Main/2008847; classtype:trojan-activity; sid:2008847; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Errordigger.com related)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"min"; depth:3; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008912; classtype:trojan-activity; sid:2008912; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Trojan.Hijack.IrcBot.457 related)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"Mozilla/1.0 (compatible|3b 20|MSIE 8.0|3b|"; depth:34; reference:url,doc.emergingthreats.net/bin/view/Main/2008913; classtype:trojan-activity; sid:2008913; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (xr - Worm.Win32.VB.cj related)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"xr"; depth:2; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008914; classtype:trojan-activity; sid:2008914; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (HELLO)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"HELLO"; depth:5; endswith; nocase; reference:url,doc.emergingthreats.net/bin/view/Main/2008941; classtype:trojan-activity; sid:2008941; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (IE/1.0)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"IE/1.0"; depth:6; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008956; classtype:trojan-activity; sid:2008956; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (runUpdater.html)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"runUpdater|2e|html"; depth:15; reference:url,doc.emergingthreats.net/2009355; classtype:trojan-activity; sid:2009355; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (runPatch.html)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"runPatch|2e|html"; depth:13; reference:url,doc.emergingthreats.net/2009356; classtype:trojan-activity; sid:2009356; rev:11; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (INet)"; flow:established,to_server; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"INet"; depth:4; endswith; reference:url,doc.emergingthreats.net/2009703; classtype:trojan-activity; sid:2009703; rev:10; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS User-Agent (STEROID Download)"; flow:established,to_server; http.user_agent; content:"STEROID Download"; nocase; depth:16; endswith; reference:url,anubis.iseclab.org/?action=result&task_id=17b118a86edba30f4f588db66eaf55d10; reference:url,security.thejoshmeister.com/2009/09/new-malware-ddos-botexe-etc-and.html; reference:url,doc.emergingthreats.net/2009994; classtype:trojan-activity; sid:2009994; rev:10; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Win32.OnLineGames User-Agent (BigFoot)"; flow:to_server,established; http.user_agent; content:"BigFoot"; nocase; depth:7; reference:url,doc.emergingthreats.net/2010678; classtype:trojan-activity; sid:2010678; rev:9; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (NateFinder)"; flow:to_server,established; http.user_agent; content:"NateFinder"; depth:10; classtype:trojan-activity; sid:2013881; rev:6; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_11_08, deployment Perimeter, former_category TROJAN, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Updater)"; flow:to_server,established; http.user_agent; content:"Updater"; depth:7; endswith; reference:url,doc.emergingthreats.net/2003470; classtype:pup-activity; sid:2003470; rev:13; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_17;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (update)"; flow:to_server,established; threshold: type limit, count 3, seconds 300, track by_src; http.user_agent; content:"update"; depth:6; endswith; reference:url,doc.emergingthreats.net/2003583; classtype:pup-activity; sid:2003583; rev:14; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Huai_Huai)"; flow:to_server,established; http.user_agent; content:"Huai_Huai"; depth:9; endswith; reference:md5,ee600bdcc45989750dee846b5049f935; reference:md5,91b9aa25563ae524d3ca4582630eb8eb; reference:md5,1051f7176fe0a50414649d369e752e98; classtype:pup-activity; sid:2006361; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (FTP)"; flow: to_server,established; http.user_agent; content:"Ftp"; nocase; depth:3; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2008735; classtype:pup-activity; sid:2008735; rev:11; metadata:created_at 2010_07_30, former_category HUNTING, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (FaceCooker)"; flow:to_server,established; http.user_agent; content:"FaceCooker"; nocase; depth:10; reference:url,doc.emergingthreats.net/2010717; classtype:pup-activity; sid:2010717; rev:8; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (lineguide)"; flow:to_server,established; http.user_agent; content:"lineguide"; nocase; depth:9; reference:url,doc.emergingthreats.net/2011106; classtype:pup-activity; sid:2011106; rev:8; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Eldorado.BHO User-Agent Detected (MSIE 5.5)"; flow:established,to_server; http.method; content:"GET"; nocase; http.user_agent; content:"MSIE 5.5"; depth:8; endswith; reference:url,doc.emergingthreats.net/2007833; classtype:trojan-activity; sid:2007833; rev:9; metadata:created_at 2010_07_30, former_category TROJAN, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (ScrapeBox)"; flow:to_server,established; http.user_agent; content:"ScrapeBox"; depth:9; classtype:trojan-activity; sid:2011282; rev:6; metadata:created_at 2010_09_28, former_category HUNTING, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS suspicious user-agent (REKOM)"; flow:established,to_server; http.method; content:"GET"; http.user_agent; content:"REKOM"; nocase; depth:5; classtype:trojan-activity; sid:2012295; rev:6; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_02_07, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent VCTestClient"; flow:to_server,established; http.user_agent; content:"VCTestClient"; depth:12; nocase; classtype:trojan-activity; sid:2012386; rev:5; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2011_02_27, deployment Perimeter, signature_severity Major, tag User_Agent, updated_at 2020_10_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Fire-Cloud)"; flow:established,to_server; http.user_agent; content:"Fire-Cloud"; bsize:10; reference:md5,804c8f7d3b10b421ab5c09d675644212; classtype:trojan-activity; sid:2031065; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_10_20, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2020_10_20;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Steam HTTP Client User-Agent"; flow:established,to_server; threshold: type limit, track by_src, count 1, seconds 300; http.user_agent; content:"SteamHTTPClient"; depth:15; endswith; classtype:policy-violation; sid:2028650; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2019_10_07, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2020_10_20;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User Agent (Autoupdate)"; flow:to_server,established; http.header; content:!" Creative AutoUpdate v"; http.user_agent; content:"Autoupdate"; nocase; depth:10; content:!"McAfeeAutoUpdate"; nocase; http.host; content:!"update.nai.com"; content:!"nokia.com"; content:!"sophosupd.com"; content:!"sophosupd.net"; content:!"wholetomato.com"; content:!".acclivitysoftware.com"; reference:url,doc.emergingthreats.net/bin/view/Main/2003337; classtype:pup-activity; sid:2003337; rev:22; metadata:created_at 2010_07_30, former_category HUNTING, updated_at 2020_11_02;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious HttpSocket User-Agent Observed"; flow:established,to_server; http.user_agent; content:"HttpSocket By Xswallow"; depth:22; classtype:misc-activity; sid:2031167; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2020_11_03, deployment Perimeter, signature_severity Major, updated_at 2020_11_03;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS AnyDesk Remote Desktop Software User-Agent"; flow:established,to_server; http.user_agent; content:"AnyDesk"; depth:7; reference:md5,1501639af59b0ff39d41577af30367cf; classtype:policy-violation; sid:2027762; rev:4; metadata:attack_target Client_Endpoint, created_at 2019_07_26, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2022_05_03;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS ESET Installer"; flow:established,to_server; threshold: type limit, track by_src, seconds 180, count 1; http.user_agent; content:"ESET Installer"; depth:14; endswith; classtype:policy-violation; sid:2027219; rev:4; metadata:attack_target Client_Endpoint, created_at 2019_04_17, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, tag PUA, updated_at 2022_05_03;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (downloader)"; flow:to_server,established; http.user_agent; content:"downloader"; depth:10; endswith; reference:url,doc.emergingthreats.net/bin/view/Main/2007885; classtype:pup-activity; sid:2007885; rev:13; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2022_05_03;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent Simple Bot"; flow:established,to_server; http.user_agent; content:"Simple Bot v"; startswith; fast_pattern; reference:md5,3cf04350400299844abb17a0e1640975; classtype:bad-unknown; sid:2031471; rev:1; metadata:attack_target Client_Endpoint, created_at 2020_12_31, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2020_12_31;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (aaaa)"; flow:established,to_server; http.user_agent; content:"aaaa"; bsize:4; reference:md5,61e213e717cc8e156cec79a7c1cd0c64; classtype:bad-unknown; sid:2031613; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_02_11, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2021_02_11;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Collection Info)"; flow:established,to_server; http.user_agent; content:"Collection Info/1.0"; bsize:19; fast_pattern; reference:md5,864eace6e6f67b77163d7ed5da4498c8; reference:url,github.com/AmnestyTech/investigations/tree/master/2021-02-24_vietnam; reference:url,www.amnesty.org/en/latest/research/2021/02/click-and-bait-vietnamese-human-rights-defenders-targeted-with-spyware-attacks/; classtype:bad-unknown; sid:2031684; rev:1; metadata:created_at 2021_03_01, former_category USER_AGENTS, performance_impact Low, updated_at 2021_03_01;)

            alert http any any -> any any (msg:"ET USER_AGENTS Suspicious User-Agent (HaxerMen)"; flow:established,to_server; http.user_agent; content:"HaxerMen"; bsize:8; fast_pattern; reference:md5,19aa54bd0c5a4b78f47247bb432b689d; classtype:bad-unknown; sid:2032081; rev:2; metadata:attack_target Client_Endpoint, created_at 2021_03_16, deployment Perimeter, former_category USER_AGENTS, signature_severity Major, updated_at 2021_03_16;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Non-standard User-Agent (PATCHER)"; flow:established,to_server; http.header; content:"User-Agent|3a 20|PATCHER|0d 0a|"; classtype:policy-violation; sid:2032938; rev:1; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2021_05_11, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2021_05_11;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious User-Agent (altera forma)"; flow:established,to_server; http.user_agent; content:"altera|20|forma"; bsize:12; fast_pattern; reference:md5,f019d3031c3aaf45dbd3630a33ab0991; classtype:bad-unknown; sid:2032948; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_05_12, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2021_05_12;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (MyAgent)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.header; content:!"www.google-analytics.com"; http.user_agent; content:"MyAgent"; depth:7; fast_pattern; http.host; content:!"driverdl.lenovo.com.cn"; reference:url,doc.emergingthreats.net/bin/view/Main/2005320; classtype:trojan-activity; sid:2005320; rev:16; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2021_06_15;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS WaterDropX PRISM UA Observed"; flow:established,to_server; http.user_agent; content:"agent-waterdropx"; fast_pattern; classtype:command-and-control; sid:2033269; rev:1; metadata:created_at 2021_07_07, former_category USER_AGENTS, malware_family PRISM, tag WaterDropX, updated_at 2021_07_07;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Malicious User-Agent (Brute Force Attacks)"; flow:established,to_server; http.user_agent; content:"Mozilla/5.0|20|(Windows|20|NT|20|10.0|3b 20|Win64|3b 20|x64)|20|AppleWebKit/537.36|20|(KHTML,|20|like|20|Gecko)|20|Chrome/70."; bsize:91; reference:url,media.defense.gov/2021/Jul/01/2002753896/-1/-1/1/CSA_GRU_GLOBAL_BRUTE_FORCE_CAMPAIGN_UOO158036-21.PDF; classtype:bad-unknown; sid:2033314; rev:1; metadata:created_at 2021_07_12, former_category USER_AGENTS, updated_at 2021_07_12;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Malicious User-Agent (Brute Force Attacks)"; flow:established,to_server; http.user_agent; content:"Microsoft|20|Office/14.0|20|(Windows|20|NT|20|6.1|3b 20|Microsoft|20|Outlook|20|14.0.7162|3b 20|Pro"; bsize:71; reference:url,media.defense.gov/2021/Jul/01/2002753896/-1/-1/1/CSA_GRU_GLOBAL_BRUTE_FORCE_CAMPAIGN_UOO158036-21.PDF; classtype:bad-unknown; sid:2033315; rev:1; metadata:created_at 2021_07_12, former_category USER_AGENTS, updated_at 2021_07_12;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS sysWeb User-Agent"; flow:established,to_server; http.user_agent; content:"|20|sysWeb/"; fast_pattern; reference:md5,3f295401fa59a32ff7a11551551ec607; reference:url,twitter.com/starsSk87264403/status/1422543872853426198; classtype:trojan-activity; sid:2033665; rev:1; metadata:created_at 2021_08_04, former_category USER_AGENTS, performance_impact Low, updated_at 2021_08_04;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Embarcadero URI Client/1.0)"; flow:established,to_server; http.user_agent; content:"Embarcadero URI Client/1.0"; bsize:26; reference:md5,c0e620ed4e96aa1fe8452a3f8b7e2e8d; classtype:bad-unknown; sid:2034244; rev:2; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2021_10_25, deployment Perimeter, former_category USER_AGENTS, signature_severity Major, tag User_Agent, updated_at 2021_10_25;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (Microsoft-ATL-Native/9.00)"; flow:established,to_server; http.user_agent; content:"Microsoft-ATL-Native/9.00"; bsize:25; reference:md5,783aef84f5b315704ff6b064a00e2573; classtype:bad-unknown; sid:2034296; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_10_29, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2021_10_29;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (urlRequest)"; flow:established,to_server; http.user_agent; content:"urlRequest"; bsize:10; reference:md5,988fbcfeebf2a49af4072030dead68f9; classtype:bad-unknown; sid:2034298; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_10_29, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2021_10_29;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (test-upload)"; flow:established,to_server; http.user_agent; content:"test-upload"; nocase; bsize:11; reference:md5,c110a5814451bbfba9eb41a2b2328213; classtype:bad-unknown; sid:2034548; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_11_29, deployment Perimeter, former_category USER_AGENTS, signature_severity Informational, updated_at 2021_11_29;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (dBrowser CallGetResponse)"; flow:to_server,established; threshold: type limit, count 2, track by_src, seconds 300; http.user_agent; content:"dBrowser"; startswith; content:"CallGetResponse:"; fast_pattern; distance:3; within:16; pcre:"/^dBrowser\x20\d\x20CallGetResponse\x3a\d$/V"; reference:md5,e09ad59bff10bd4b730ee643809ec9a7; classtype:trojan-activity; sid:2034948; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2022_01_19, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2022_01_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Suspicious UA (Chrome)"; flow:established,to_server; content:"User-Agent|3a 20|Chrome|0d 0a|"; http_header; fast_pattern; classtype:bad-unknown; sid:2027916; rev:4; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2019_08_26, deployment Perimeter, former_category HUNTING, performance_impact Low, signature_severity Informational, updated_at 2022_01_25;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (example/1.0)"; flow:to_server,established; http.user_agent; content:"example/1.0"; bsize:11; startswith; reference:url,cybereason.com/blog/strifewater-rat-iranian-apt-moses-staff-adds-new-trojan-to-ransomware-operations; classtype:bad-unknown; sid:2035032; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2022_02_01, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2022_02_07;)

            alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ET USER_AGENTS Suspcious LeakIX User-Agent (l9explore)"; flow:established,to_server; http.user_agent; content:"l9explore"; startswith; fast_pattern; reference:url,ithub.com/LeakIX/l9format; classtype:bad-unknown; sid:2035314; rev:2; metadata:affected_product Linux, attack_target Server, created_at 2022_02_28, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2022_02_28;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (ItIsMe)"; flow:to_server,established; http.user_agent; content:"ItIsMe"; depth:6; fast_pattern; reference:url,resources.cylera.com/new-evidence-linking-kwampirs-malware-to-shamoon-apts; classtype:trojan-activity; sid:2035445; rev:2; metadata:attack_target Client_Endpoint, created_at 2022_03_14, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Informational, updated_at 2022_03_14;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (HTTP-Test-Program)"; flow:to_server,established; http.user_agent; content:"HTTP-Test-Program"; bsize:17; startswith; reference:md5,6e69e15ae55aee85ace66bb99e6ba885; classtype:bad-unknown; sid:2035452; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2022_03_14, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2022_03_14;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Malicious User-Agent (CobaltStrike)"; flow:to_server,established; http.user_agent; content:"Mozilla/5.0_Frsg_stredf_o21_crown_type"; startswith; fast_pattern; reference:md5,b8b7a10dcc0dad157191620b5d4e5312; classtype:trojan-activity; sid:2035537; rev:2; metadata:attack_target Client_Endpoint, created_at 2022_03_18, deployment Perimeter, former_category USER_AGENTS, malware_family Cobalt_Strike, signature_severity Major, updated_at 2022_03_18, mitre_tactic_id TA0011, mitre_tactic_name Command_And_Control, mitre_technique_id T1001, mitre_technique_name Data_Obfuscation;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Malicious User-Agent (FastInvoice)"; flow:established,to_server; http.user_agent; content:"FastInvoice"; bsize:11; startswith; fast_pattern; reference:md5,42218b0ce7fc47f80aa239d4f9e000a1; classtype:bad-unknown; sid:2035932; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2022_04_13, deployment Perimeter, former_category USER_AGENTS, signature_severity Minor, updated_at 2022_04_13;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed Bumblebee Loader User-Agent (bumblebee)"; flow:established,to_server; http.user_agent; content:"bumblebee"; bsize:9; fast_pattern; reference:md5,555b77d23549e231c8d7f0b003cc5164; reference:md5,3f34d94803e9c8bc0a9cd09f507bc515; reference:url,www.cynet.com/orion-threat-alert-flight-of-the-bumblebee/; reference:url,blog.google/threat-analysis-group/exposing-initial-access-broker-ties-conti/; classtype:trojan-activity; sid:2036237; rev:1; metadata:attack_target Client_Endpoint, created_at 2022_04_18, deployment Perimeter, deployment SSLDecrypt, former_category USER_AGENTS, malware_family Bumblebee_Loader, signature_severity Major, updated_at 2022_04_18;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Observed DPRK Related APT User-Agent (dafom)"; flow:established,to_server; http.user_agent; content:"dafom"; bsize:5; fast_pattern; reference:url,www.cisa.gov/uscert/ncas/current-activity/2022/04/18/north-korean-state-sponsored-apt-targets-blockchain-companies; classtype:bad-unknown; sid:2036260; rev:1; metadata:attack_target Client_Endpoint, created_at 2022_04_19, deployment Perimeter, deployment SSLDecrypt, former_category USER_AGENTS, signature_severity Informational, updated_at 2022_04_19;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (006)"; flow:established,to_server; http.user_agent; content:"00"; depth:2; pcre:"/00\d+$/"; reference:url,doc.emergingthreats.net/bin/view/Main/2006388; classtype:pup-activity; sid:2006388; rev:12; metadata:affected_product Any, attack_target Client_Endpoint, created_at 2010_07_30, deployment Perimeter, former_category HUNTING, signature_severity Major, tag User_Agent, updated_at 2022_05_03;)

            alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET USER_AGENTS Suspicious User-Agent (REBOL)"; flow:established,to_server; http.user_agent; content:"REBOL"; nocase; startswith; reference:url,twitter.com/James_inthe_box/status/1441140639169609736; classtype:bad-unknown; sid:2034021; rev:2; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, created_at 2021_09_24, deployment Perimeter, former_category USER_AGENTS, performance_impact Low, signature_severity Minor, updated_at 2022_05_03;)
      Tags:
        - Key: Name
          Value: "Alert-Protocol-Anomalies-Detection"
        - Key: Environment
          Value: !Ref pEnvironmentName